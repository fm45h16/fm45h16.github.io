<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        Hackthebox - Nest Writeup - fmash16&#39;s blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="An easy machine in HTB standards, but is quite hard." />
    <meta name="generator" content="Hugo 0.71.0 with theme pure" />
    <title>Hackthebox - Nest Writeup - fmash16&#39;s blog</title>
    
    
    <link rel="stylesheet" href="https://fmash16.github.io/css/style.min.7da690b0190e15a7d877c45a0c70585e1afa92409e2100ebbdb0fa7ed5ffc0fb.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="Hackthebox - Nest Writeup" />
<meta property="og:description" content="An easy machine in HTB standards, but is quite hard." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-nest-writeup/" />
<meta property="og:image" content="https://fmash16.github.io/img/htb_nest/card.png" />
<meta property="og:image" content="https://fmash16.github.io/" />
<meta property="article:published_time" content="2020-06-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-05T00:00:00+00:00" />

<meta itemprop="name" content="Hackthebox - Nest Writeup">
<meta itemprop="description" content="An easy machine in HTB standards, but is quite hard.">
<meta itemprop="datePublished" content="2020-06-05T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-06-05T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1526">
<meta itemprop="image" content="https://fmash16.github.io/img/htb_nest/card.png">
<meta itemprop="image" content="https://fmash16.github.io/">



<meta itemprop="keywords" content="smbclient,smb,.NET,C#,VB,Visual Basic,dnSpy,.netfiddle,windows," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://fmash16.github.io/img/htb_nest/card.png"/>

<meta name="twitter:title" content="Hackthebox - Nest Writeup"/>
<meta name="twitter:description" content="An easy machine in HTB standards, but is quite hard."/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->

   
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto&#43;Sans&#43;JP&amp;display=swap" type="text/css" media="all" /> 
   

  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle img-rotate" src="https://fmash16.github.io/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">fmash16</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Student</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dhaka, Bangladesh</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>

        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Posts</span>
                </a>
            </li>
            <li class="menu-item menu-item-books">
                <a href="/categories/">
                    <i class="icon icon-book-fill"></i>
                  <span class="menu-title">Writeups</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
  <h3 class="widget-title"><u> Categories</u></h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://fmash16.github.io/categories/hackthebox-writeups/" class="category-list-link">hackthebox-writeups</a><span class="category-list-count">8</span></li>
            <li class="category-list-item"><a href="https://fmash16.github.io/categories/tryhackme-writeups/" class="category-list-link">tryhackme-writeups</a><span class="category-list-count">4</span></li>
        </ul>
    </div>
</div>
<div class="widget">
  <h3 class="widget-title"><u> Tags </u></h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <a href="https://fmash16.github.io/tags/.net/" class="tag-list-link">.net</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/.netfiddle/" class="tag-list-link">.netfiddle</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/ad/" class="tag-list-link">ad</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/adminer/" class="tag-list-link">adminer</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/azure/" class="tag-list-link">azure</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/azure-ad-connect/" class="tag-list-link">azure-ad-connect</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/bludit-cms/" class="tag-list-link">bludit-cms</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/brainfuck/" class="tag-list-link">brainfuck</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/c#/" class="tag-list-link">c#</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cewl/" class="tag-list-link">cewl</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/command-injection/" class="tag-list-link">command-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/crackmapexec/" class="tag-list-link">crackmapexec</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cron/" class="tag-list-link">cron</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/crontab/" class="tag-list-link">crontab</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cve-2019-14287/" class="tag-list-link">cve-2019-14287</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dll/" class="tag-list-link">dll</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dns/" class="tag-list-link">dns</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dnsadmins/" class="tag-list-link">dnsadmins</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dnspy/" class="tag-list-link">dnspy</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/docker/" class="tag-list-link">docker</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/dynamic-js/" class="tag-list-link">dynamic-js</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dynamic-xss/" class="tag-list-link">dynamic-xss</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/easy/" class="tag-list-link">easy</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/evil-winrm/" class="tag-list-link">evil-winrm</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/file-descriptor/" class="tag-list-link">file-descriptor</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/ftp/" class="tag-list-link">ftp</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/fuzzing/" class="tag-list-link">fuzzing</a><span class="tag-list-count">4</span>
            
            
            <a href="https://fmash16.github.io/tags/gila-cms/" class="tag-list-link">gila-cms</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/gtfobins/" class="tag-list-link">gtfobins</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/hacking/" class="tag-list-link">hacking</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/hydra/" class="tag-list-link">hydra</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/injection/" class="tag-list-link">injection</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/john/" class="tag-list-link">john</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/kvm/" class="tag-list-link">kvm</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/ldap/" class="tag-list-link">ldap</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/ldapsearch/" class="tag-list-link">ldapsearch</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/lfi/" class="tag-list-link">lfi</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/linux/" class="tag-list-link">linux</a><span class="tag-list-count">3</span>
            
            
            <a href="https://fmash16.github.io/tags/logrotate-race-condition/" class="tag-list-link">logrotate-race-condition</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/mysql/" class="tag-list-link">mysql</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/mysqldump/" class="tag-list-link">mysqldump</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/passthrough/" class="tag-list-link">passthrough</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/php/" class="tag-list-link">php</a><span class="tag-list-count">4</span>
            
            
            <a href="https://fmash16.github.io/tags/powershell/" class="tag-list-link">powershell</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/practice/" class="tag-list-link">practice</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/privesc/" class="tag-list-link">privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/pt_chown/" class="tag-list-link">pt_chown</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/pwn/" class="tag-list-link">pwn</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/python/" class="tag-list-link">python</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/python-path-hijack/" class="tag-list-link">python-path-hijack</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/qemu/" class="tag-list-link">qemu</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/rce/" class="tag-list-link">rce</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/real-world/" class="tag-list-link">real-world</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/rpcclient/" class="tag-list-link">rpcclient</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/smb/" class="tag-list-link">smb</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/smbclient/" class="tag-list-link">smbclient</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sql/" class="tag-list-link">sql</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sql-truncation-attack/" class="tag-list-link">sql-truncation-attack</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/stego/" class="tag-list-link">stego</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/subdomain/" class="tag-list-link">subdomain</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sudo/" class="tag-list-link">sudo</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/sudo-privesc/" class="tag-list-link">sudo-privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/tar/" class="tag-list-link">tar</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/vb/" class="tag-list-link">vb</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/virtualization/" class="tag-list-link">virtualization</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/visual-basic/" class="tag-list-link">visual-basic</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/web/" class="tag-list-link">web</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/wfuzz/" class="tag-list-link">wfuzz</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/wildcard/" class="tag-list-link">wildcard</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/windows/" class="tag-list-link">windows</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/xss/" class="tag-list-link">xss</a><span class="tag-list-count">1</span>
            
        </ul>

    </div>
</div>

<div class="widget">
  <h3 class="widget-title"><u> Recent Posts </u></h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-nest-writeup/" class="title">Hackthebox - Nest Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-05 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-05</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" class="title">Hackthebox - Resolute Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-28 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-28</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-book-writeup/" class="title">Hackthebox - Book Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-04</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/tryhackme-writeups/tryhackme-cmess-writeup/" class="title">TryHackMe - CMesS Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-03 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-03</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-blunder-writeup/" class="title">Hackthebox - Blunder Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-31 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-31</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>

  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Table of Contents</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>

<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h3 itemprop="name">
  <a
    class="article-title"
    href="/writeups/hackthebox-writeups/hackthebox-nest-writeup/"
    >Hackthebox - Nest Writeup</a
  >
</h3>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-nest-writeup/" class="article-date">
  <time datetime="2020-06-05 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-05</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/hackthebox-writeups/"> Hackthebox Writeups </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/smbclient/"> smbclient </a>
    <a class="article-tag-link" href="/tags/smb/"> smb </a>
    <a class="article-tag-link" href="/tags/.net/"> .NET </a>
    <a class="article-tag-link" href="/tags/c/"> C# </a>
    <a class="article-tag-link" href="/tags/vb/"> VB </a>
    <a class="article-tag-link" href="/tags/visual-basic/"> Visual Basic </a>
    <a class="article-tag-link" href="/tags/dnspy/"> dnSpy </a>
    <a class="article-tag-link" href="/tags/.netfiddle/"> .netfiddle </a>
    <a class="article-tag-link" href="/tags/windows/"> windows </a>
  </span>
<br>
        
        
        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p><img src="/img/htb_nest/card.png" alt=""></p>
<h1 id="nmap-scan">Nmap scan</h1>
<p>Open ports:</p>
<ul>
<li>445/tcp microsoft-ds?</li>
<li>4386/tcp open  unknown</li>
</ul>
<h1 id="enumeration">Enumeration</h1>
<h2 id="smbclient">smbclient</h2>
<p>We use smblient to list the shares. And find a share named &ldquo;Data&rdquo; using NULL
auth.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smbclient -L <span style="color:#ed9d13">\\\\</span>10.10.10.178
</code></pre></div><p><img src="/img/htb_nest/1.png" alt=""> We connect to the share using</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smbclient <span style="color:#ed9d13">\\\\</span>10.10.10.178<span style="color:#ed9d13">\\</span>Data
</code></pre></div><p>We find an interesting file under <code>\Shared\Templates\HR\</code> named &ldquo;Welcome
Email.txt&rdquo;. We get the file on our local mahcine using</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smb: <span style="color:#ed9d13">\S</span>hared<span style="color:#ed9d13">\T</span>emplates<span style="color:#ed9d13">\H</span>R<span style="color:#ed9d13">\&gt;</span> get <span style="color:#ed9d13">&#34;Welcome Email.txt&#34;</span>
</code></pre></div><p>Having a look at the file we find</p>
<p><img src="/img/htb_nest/2.png" alt=""></p>
<p>So we get some creds here. Creds found:</p>
<blockquote>
<p>Username: TempUser<br>
Password: welcome2019</p>
</blockquote>
<h1 id="privilege-escalation---user">Privilege Escalation - User</h1>
<h2 id="encrypted-password-find">Encrypted password find</h2>
<p>Logging in to the smbserver using these creds, we see that we have access to
the IT folder.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smbclient <span style="color:#ed9d13">\\\\</span>10.10.10.178<span style="color:#ed9d13">\\</span>Data -U TempUser%welcome2019
</code></pre></div><p>We find an intersting file RU_config.xml under <code>\IT\Configs\RU Scanner\</code>.
Catting out the contents, we find some creds here</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span><span style="color:#cd2828;font-weight:bold">&lt;?xml version=&#34;1.0&#34;?&gt;</span> <span style="color:#6ab825;font-weight:bold">&lt;ConfigFile</span> <span style="color:#bbb">xmlns:xsi=</span><span style="color:#ed9d13">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style="color:#bbb">xmlns:xsd=</span><span style="color:#ed9d13">&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span style="color:#6ab825;font-weight:bold">&gt;</span> <span style="color:#6ab825;font-weight:bold">&lt;Port&gt;</span>389<span style="color:#6ab825;font-weight:bold">&lt;/Port&gt;</span> <span style="color:#6ab825;font-weight:bold">&lt;Username&gt;</span>c.smith<span style="color:#6ab825;font-weight:bold">&lt;/Username&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>  <span style="color:#6ab825;font-weight:bold">&lt;Password&gt;</span>fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=<span style="color:#6ab825;font-weight:bold">&lt;/Password&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span><span style="color:#6ab825;font-weight:bold">&lt;/ConfigFile&gt;</span>
</code></pre></div><p>The password seems to be base64 encoded. So we decode it</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span><span style="color:#24909d">echo</span> <span style="color:#40ffff">fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE</span>= | base64 -d
</code></pre></div><p>The password includes unicode characters. So the hash is not base64. We look
around the smbshare more and find something interesting in the config.xml file
of notepad++</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>&lt;<span style="color:#24909d">History </span>nbMaxFile=<span style="color:#ed9d13">&#34;15&#34;</span> inSubMenu=<span style="color:#ed9d13">&#34;no&#34;</span> customLength=<span style="color:#ed9d13">&#34;-1&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>    &lt;File filename=<span style="color:#ed9d13">&#34;C:\windows\System32\drivers\etc\hosts&#34;</span> /&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span>    &lt;File filename=<span style="color:#ed9d13">&#34;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&#34;</span> /&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4</span>    &lt;File filename=<span style="color:#ed9d13">&#34;C:\Users\C.Smith\Desktop\todo.txt&#34;</span> /&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5</span>&lt;/History&gt;
</code></pre></div><h2 id="vb-script-encryption-debug">VB script encryption debug</h2>
<p>In &ldquo;VB Projects/WIP/RU/RUScanner&rdquo; we find some visual basic scripts. These seem
to perform the encryption and decryption of the password of the user. The
script Utils.vb contains the decrypt funciton. We can use this script to
decrypt the encrypted pass we found using online vb.net compiler <a href="https://dotnetfiddle.net/bjoBP6">here.</a></p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vb" data-lang="vb"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  1</span><span style="color:#6ab825;font-weight:bold">Imports</span> <span style="color:#447fcf;text-decoration:underline">System</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  2</span><span style="color:#6ab825;font-weight:bold">Imports</span> <span style="color:#447fcf;text-decoration:underline">System.Text</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  3</span><span style="color:#6ab825;font-weight:bold">Imports</span> <span style="color:#447fcf;text-decoration:underline">System.Security.Cryptography</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  4</span>        
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  5</span><span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Module</span> <span style="color:#447fcf;text-decoration:underline">Module1</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  7</span>  <span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Sub</span> <span style="color:#447fcf">Main</span>()Main
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  8</span>    Console.WriteLine(<span style="color:#ed9d13">&#34;Decrypted: &#34;</span> + DecryptString(EncryptString(<span style="color:#ed9d13">&#34;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&#34;</span>)))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  9</span>  <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Sub</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 10</span>  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 11</span>    <span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Function</span> <span style="color:#447fcf">DecryptString</span>(EncryptedString <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>) <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 12</span>        <span style="color:#6ab825;font-weight:bold">If</span> <span style="color:#6ab825;font-weight:bold">String</span>.IsNullOrEmpty(EncryptedString) <span style="color:#6ab825;font-weight:bold">Then</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 13</span>            <span style="color:#6ab825;font-weight:bold">Return</span> <span style="color:#6ab825;font-weight:bold">String</span>.Empty
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 14</span>        <span style="color:#6ab825;font-weight:bold">Else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 15</span>            <span style="color:#6ab825;font-weight:bold">Return</span> Decrypt(EncryptedString, <span style="color:#ed9d13">&#34;N3st22&#34;</span>, <span style="color:#ed9d13">&#34;88552299&#34;</span>, 2, <span style="color:#ed9d13">&#34;464R5DFA5DL6LE28&#34;</span>, 256)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 16</span>        <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">If</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 17</span>    <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Function</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 18</span>  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 19</span>    <span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Function</span> <span style="color:#447fcf">EncryptString</span>(PlainString <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>) <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 20</span>        <span style="color:#6ab825;font-weight:bold">If</span> <span style="color:#6ab825;font-weight:bold">String</span>.IsNullOrEmpty(PlainString) <span style="color:#6ab825;font-weight:bold">Then</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 21</span>            <span style="color:#6ab825;font-weight:bold">Return</span> <span style="color:#6ab825;font-weight:bold">String</span>.Empty
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 22</span>        <span style="color:#6ab825;font-weight:bold">Else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 23</span>            <span style="color:#6ab825;font-weight:bold">Return</span> Encrypt(PlainString, <span style="color:#ed9d13">&#34;N3st22&#34;</span>, <span style="color:#ed9d13">&#34;88552299&#34;</span>, 2, <span style="color:#ed9d13">&#34;464R5DFA5DL6LE28&#34;</span>, 256)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 24</span>        <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">If</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 25</span>    <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Function</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 26</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 27</span>    <span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Function</span> <span style="color:#447fcf">Encrypt</span>(<span style="color:#6ab825;font-weight:bold">ByVal</span> plainText <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 28</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> passPhrase <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 29</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> saltValue <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 30</span>                                    <span style="color:#6ab825;font-weight:bold">ByVal</span> passwordIterations <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Integer</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 31</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> initVector <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 32</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> keySize <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Integer</span>) _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 33</span>                           <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 34</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 35</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> initVectorBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>() = Encoding.ASCII.GetBytes(initVector)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 36</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> saltValueBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>() = Encoding.ASCII.GetBytes(saltValue)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 37</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> plainTextBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>() = Encoding.ASCII.GetBytes(plainText)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 38</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> password <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> Rfc2898DeriveBytes(passPhrase, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 39</span>                                           saltValueBytes, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 40</span>                                           passwordIterations)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 41</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> keyBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>() = password.GetBytes(<span style="color:#6ab825;font-weight:bold">CInt</span>(keySize / 8))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 42</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> symmetricKey <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> AesCryptoServiceProvider
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 43</span>        symmetricKey.Mode = CipherMode.CBC
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 44</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> encryptor <span style="color:#6ab825;font-weight:bold">As</span> ICryptoTransform
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 45</span>= symmetricKey.CreateEncryptor(keyBytes, initVectorBytes)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 46</span>        <span style="color:#6ab825;font-weight:bold">Using</span> memoryStream <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> IO.MemoryStream()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 47</span>            <span style="color:#6ab825;font-weight:bold">Using</span> cryptoStream <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> CryptoStream(memoryStream, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 48</span>                                            encryptor, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 49</span>                                            CryptoStreamMode.Write)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 50</span>                cryptoStream.Write(plainTextBytes, 0, plainTextBytes.Length)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 51</span>                cryptoStream.FlushFinalBlock()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 52</span>                <span style="color:#6ab825;font-weight:bold">Dim</span> cipherTextBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>() = memoryStream.ToArray()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 53</span>                memoryStream.Close()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 54</span>                cryptoStream.Close()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 55</span>                <span style="color:#6ab825;font-weight:bold">Return</span> Convert.ToBase64String(cipherTextBytes)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 56</span>            <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Using</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 57</span>        <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Using</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 58</span>    <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Function</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 59</span>  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 60</span>    <span style="color:#6ab825;font-weight:bold">Public</span> <span style="color:#6ab825;font-weight:bold">Function</span> <span style="color:#447fcf">Decrypt</span>(<span style="color:#6ab825;font-weight:bold">ByVal</span> cipherText <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 61</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> passPhrase <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 62</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> saltValue <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 63</span>                                    <span style="color:#6ab825;font-weight:bold">ByVal</span> passwordIterations <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Integer</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 64</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> initVector <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 65</span>                                   <span style="color:#6ab825;font-weight:bold">ByVal</span> keySize <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Integer</span>) _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 66</span>                           <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 67</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 68</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> initVectorBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 69</span>        initVectorBytes = Encoding.ASCII.GetBytes(initVector)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 70</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 71</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> saltValueBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 72</span>        saltValueBytes = Encoding.ASCII.GetBytes(saltValue)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 73</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 74</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> cipherTextBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 75</span>        cipherTextBytes = Convert.FromBase64String(cipherText)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 76</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 77</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> password <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> Rfc2898DeriveBytes(passPhrase, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 78</span>                                           saltValueBytes, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 79</span>                                           passwordIterations)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 80</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 81</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> keyBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 82</span>        keyBytes = password.GetBytes(<span style="color:#6ab825;font-weight:bold">CInt</span>(keySize / 8))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 83</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 84</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> symmetricKey <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">New</span> AesCryptoServiceProvider
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 85</span>        symmetricKey.Mode = CipherMode.CBC
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 86</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 87</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> decryptor <span style="color:#6ab825;font-weight:bold">As</span> ICryptoTransform
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 88</span>        decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 89</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 90</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> memoryStream <span style="color:#6ab825;font-weight:bold">As</span> IO.MemoryStream
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 91</span>        memoryStream = <span style="color:#6ab825;font-weight:bold">New</span> IO.MemoryStream(cipherTextBytes)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 92</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 93</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> cryptoStream <span style="color:#6ab825;font-weight:bold">As</span> CryptoStream
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 94</span>        cryptoStream = <span style="color:#6ab825;font-weight:bold">New</span> CryptoStream(memoryStream, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 95</span>                                        decryptor, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 96</span>                                        CryptoStreamMode.Read)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 97</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 98</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> plainTextBytes <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Byte</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 99</span>        <span style="color:#6ab825;font-weight:bold">ReDim</span> plainTextBytes(cipherTextBytes.Length)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">100</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">101</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> decryptedByteCount <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">Integer</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">102</span>        decryptedByteCount = cryptoStream.Read(plainTextBytes, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">103</span>                                               0, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">104</span>                                               plainTextBytes.Length)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">105</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">106</span>        memoryStream.Close()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">107</span>        cryptoStream.Close()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">108</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">109</span>        <span style="color:#6ab825;font-weight:bold">Dim</span> plainText <span style="color:#6ab825;font-weight:bold">As</span> <span style="color:#6ab825;font-weight:bold">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">110</span>        plainText = Encoding.ASCII.GetString(plainTextBytes, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">111</span>                                            0, _
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">112</span>                                            decryptedByteCount)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">113</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">114</span>        <span style="color:#6ab825;font-weight:bold">Return</span> plainText
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">115</span>    <span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Function</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">116</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">117</span>  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">118</span><span style="color:#6ab825;font-weight:bold">End</span> <span style="color:#6ab825;font-weight:bold">Module</span>
</code></pre></div><p>Decrypting, we find the password.</p>
<p>Creds found:</p>
<blockquote>
<p>User: c.smith<br>
Password: xRxRxPANCAK3SxRxRx</p>
</blockquote>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smbclient <span style="color:#ed9d13">\\\\</span>10.10.10.178<span style="color:#ed9d13">\\</span>Users -U c.smith%xRxRxPANCAK3SxRxRx
</code></pre></div><p>Listing the files recursively, we find our required user.txt</p>
<h1 id="privilege-escalation---administrator">Privilege Escalation - Administrator</h1>
<h2 id="hqk-reporting-service---port-4386">HQK reporting service - Port 4386</h2>
<p>From the nmap port scan, we found an open port 4386. Banner grabbing using nc,
we find a service &ldquo;HQK Reporting Service V1.2&rdquo; running on the port. We get
a prompt but cannot execute any commands connecting with nc. We try with telned
and get success.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>telnet 10.10.10.178 <span style="color:#3677a9">4386</span>
</code></pre></div><h2 id="debug-mode-password---ntfs-ads">DEBUG mode password - ntfs ADS</h2>
<p>But we have limited execution. We can enter a debuyg mode using a debug mode
password. We found a file named &ldquo;Debug Mode Password.txt&rdquo; in the <code>Users\C.Smith</code>
share. We see that the file is empty. Looking around for quite a while, and
using some help from the forum , I came to know of <a href="https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/">ntfs alternate data
streams</a>. So basically, data can be stored in the ntfs files in a different stream for obsfucation. We can see that the file has an alternate data stream using allinfo command. We can get the data from the alternate stream executing the following</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smb: <span style="color:#ed9d13">\C</span>.Smith<span style="color:#ed9d13">\H</span>QK Reporting<span style="color:#ed9d13">\&gt;</span> allinfo <span style="color:#ed9d13">&#34;Debug Mode Password.txt&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>smb: <span style="color:#ed9d13">\C</span>.Smith<span style="color:#ed9d13">\H</span>QK Reporting<span style="color:#ed9d13">\&gt;</span> get <span style="color:#ed9d13">&#34;Debug Mode Password.txt:Password&#34;</span>
</code></pre></div><p>Creds found:</p>
<blockquote>
<p>Password: WBQ201953D8w</p>
</blockquote>
<h2 id="ldap-creds-found">LDAP creds found</h2>
<p>Now, we can use this password to enter debug mode on HQK and get more access to
the files. Looking around, we see that directory ../ is HQK/ and contains
a folder /LDAP. Going to the directory, we find a file ldap.conf that gives us
the creds for the administrator.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>Domain=nest.local
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>Port=389
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span>BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=local
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4</span>User=Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5</span>Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=
</code></pre></div><p>Creds found:</p>
<blockquote>
<p>User: Administrator<br>
Password: yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=</p>
</blockquote>
<h2 id="decryting-encrypted-pass-debugging-hqkldapexednspy">Decryting encrypted pass debugging HqkLdap.exe(dnSpy)</h2>
<p>The password is encrypted. We also found a HqkLdap.exe file there. We can have
a look at the file. We found this file in the Users share under &ldquo;C.Smith/HQK
Reporting/AD Integration Module/&quot;. The file is a .NET binary.</p>
<p>In order to debug the file, we use a tool called <a href="https://github.com/0xd4d/dnSpy">dnSpy</a>
We can decompile the binary into C# code. Looking at the code, we find a class
<code>HqkLdap.CR</code> that has a function <code>DS</code> which decrypts the string
provided. So we can use this function to decrypt our obtained hash.</p>
<p><img src="/img/htb_nest/dnspy.png" alt=""></p>
<p>We head over to the awesome <a href="https://dotnetfiddle.net/o4iGop">.netfidler</a> and edit our C#
script to decrypt our hash. The script stands</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1</span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2</span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.IO</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3</span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Security.Cryptography</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4</span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Text</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5</span>          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6</span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">Program</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8</span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">void</span> Main()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10</span>    Console.WriteLine(<span style="color:#ed9d13">&#34;Decrypting Admin Hash...&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">11</span>    Console.WriteLine(CR.DS(<span style="color:#ed9d13">&#34;yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=&#34;</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">12</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">13</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">15</span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">CR</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">16</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">17</span>    <span style="color:#999;font-style:italic">// Token: 0x06000012 RID: 18 RVA: 0x00002278 File Offset: 0x00000678
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">18</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">string</span> DS(<span style="color:#6ab825;font-weight:bold">string</span> EncryptedString)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">19</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">20</span>      <span style="color:#6ab825;font-weight:bold">if</span> (<span style="color:#6ab825;font-weight:bold">string</span>.IsNullOrEmpty(EncryptedString))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">21</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">22</span>        <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">string</span>.Empty;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">23</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">24</span>      <span style="color:#6ab825;font-weight:bold">return</span> CR.RD(EncryptedString, <span style="color:#ed9d13">&#34;667912&#34;</span>, <span style="color:#ed9d13">&#34;1313Rf99&#34;</span>, <span style="color:#3677a9">3</span>, <span style="color:#ed9d13">&#34;1L1SA61493DRV53Z&#34;</span>, <span style="color:#3677a9">256</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">25</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">26</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">27</span>    <span style="color:#999;font-style:italic">// Token: 0x06000013 RID: 19 RVA: 0x000022B0 File Offset: 0x000006B0
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">28</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">string</span> ES(<span style="color:#6ab825;font-weight:bold">string</span> PlainString)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">29</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">30</span>      <span style="color:#6ab825;font-weight:bold">if</span> (<span style="color:#6ab825;font-weight:bold">string</span>.IsNullOrEmpty(PlainString))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">31</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">32</span>        <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">string</span>.Empty;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">33</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">34</span>      <span style="color:#6ab825;font-weight:bold">return</span> CR.RE(PlainString, <span style="color:#ed9d13">&#34;667912&#34;</span>, <span style="color:#ed9d13">&#34;1313Rf99&#34;</span>, <span style="color:#3677a9">3</span>, <span style="color:#ed9d13">&#34;1L1SA61493DRV53Z&#34;</span>, <span style="color:#3677a9">256</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">35</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">36</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">37</span>    <span style="color:#999;font-style:italic">// Token: 0x06000014 RID: 20 RVA: 0x000022E8 File Offset: 0x000006E8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">38</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">string</span> RE(<span style="color:#6ab825;font-weight:bold">string</span> plainText, <span style="color:#6ab825;font-weight:bold">string</span> passPhrase, <span style="color:#6ab825;font-weight:bold">string</span> saltValue, <span style="color:#6ab825;font-weight:bold">int</span> passwordIterations, <span style="color:#6ab825;font-weight:bold">string</span> initVector, <span style="color:#6ab825;font-weight:bold">int</span> keySize)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">39</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">40</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes = Encoding.ASCII.GetBytes(initVector);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">41</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes2 = Encoding.ASCII.GetBytes(saltValue);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">42</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes3 = Encoding.ASCII.GetBytes(plainText);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">43</span>      Rfc2898DeriveBytes rfc2898DeriveBytes = <span style="color:#6ab825;font-weight:bold">new</span> Rfc2898DeriveBytes(passPhrase, bytes2, passwordIterations);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">44</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes4 = rfc2898DeriveBytes.GetBytes(<span style="color:#6ab825;font-weight:bold">checked</span>((<span style="color:#6ab825;font-weight:bold">int</span>)Math.Round((<span style="color:#6ab825;font-weight:bold">double</span>)keySize / <span style="color:#3677a9">8.0</span>)));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">45</span>      ICryptoTransform transform = <span style="color:#6ab825;font-weight:bold">new</span> AesCryptoServiceProvider
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">46</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">47</span>        Mode = CipherMode.CBC
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">48</span>      }.CreateEncryptor(bytes4, bytes);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">49</span>      <span style="color:#6ab825;font-weight:bold">string</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">50</span>      <span style="color:#6ab825;font-weight:bold">using</span> (MemoryStream memoryStream = <span style="color:#6ab825;font-weight:bold">new</span> MemoryStream())
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">51</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">52</span>        <span style="color:#6ab825;font-weight:bold">using</span> (CryptoStream cryptoStream = <span style="color:#6ab825;font-weight:bold">new</span> CryptoStream(memoryStream, transform, CryptoStreamMode.Write))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">53</span>        {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">54</span>          cryptoStream.Write(bytes3, <span style="color:#3677a9">0</span>, bytes3.Length);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">55</span>          cryptoStream.FlushFinalBlock();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">56</span>          <span style="color:#6ab825;font-weight:bold">byte</span>[] inArray = memoryStream.ToArray();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">57</span>          memoryStream.Close();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">58</span>          cryptoStream.Close();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">59</span>          result = Convert.ToBase64String(inArray);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">60</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">61</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">62</span>      <span style="color:#6ab825;font-weight:bold">return</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">63</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">64</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">65</span>    <span style="color:#999;font-style:italic">// Token: 0x06000015 RID: 21 RVA: 0x000023DC File Offset: 0x000007DC
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">66</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">string</span> RD(<span style="color:#6ab825;font-weight:bold">string</span> cipherText, <span style="color:#6ab825;font-weight:bold">string</span> passPhrase, <span style="color:#6ab825;font-weight:bold">string</span> saltValue, <span style="color:#6ab825;font-weight:bold">int</span> passwordIterations, <span style="color:#6ab825;font-weight:bold">string</span> initVector, <span style="color:#6ab825;font-weight:bold">int</span> keySize)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">67</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">68</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes = Encoding.ASCII.GetBytes(initVector);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">69</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes2 = Encoding.ASCII.GetBytes(saltValue);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">70</span>      <span style="color:#6ab825;font-weight:bold">byte</span>[] array = Convert.FromBase64String(cipherText);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">71</span>      Rfc2898DeriveBytes rfc2898DeriveBytes = <span style="color:#6ab825;font-weight:bold">new</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">72</span>Rfc2898DeriveBytes(passPhrase, bytes2, passwordIterations);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">73</span>      <span style="color:#6ab825;font-weight:bold">checked</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">74</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">75</span>        <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes3 = rfc2898DeriveBytes.GetBytes((<span style="color:#6ab825;font-weight:bold">int</span>)Math.Round((<span style="color:#6ab825;font-weight:bold">double</span>)keySize / <span style="color:#3677a9">8.0</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">76</span>        ICryptoTransform transform = <span style="color:#6ab825;font-weight:bold">new</span> AesCryptoServiceProvider
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">77</span>        {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">78</span>          Mode = CipherMode.CBC
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">79</span>        }.CreateDecryptor(bytes3, bytes);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">80</span>        MemoryStream memoryStream = <span style="color:#6ab825;font-weight:bold">new</span> MemoryStream(array);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">81</span>        CryptoStream cryptoStream = <span style="color:#6ab825;font-weight:bold">new</span> CryptoStream(memoryStream, transform, CryptoStreamMode.Read);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">82</span>        <span style="color:#6ab825;font-weight:bold">byte</span>[] array2 = <span style="color:#6ab825;font-weight:bold">new</span> <span style="color:#6ab825;font-weight:bold">byte</span>[array.Length + <span style="color:#3677a9">1</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">83</span>        <span style="color:#6ab825;font-weight:bold">int</span> count = cryptoStream.Read(array2, <span style="color:#3677a9">0</span>, array2.Length);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">84</span>        memoryStream.Close();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">85</span>        cryptoStream.Close();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">86</span>        <span style="color:#6ab825;font-weight:bold">return</span> Encoding.ASCII.GetString(array2, <span style="color:#3677a9">0</span>, count);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">87</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">88</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">89</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">90</span>    <span style="color:#999;font-style:italic">// Token: 0x04000006 RID: 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">91</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">const</span> <span style="color:#6ab825;font-weight:bold">string</span> K = <span style="color:#ed9d13">&#34;667912&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">92</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">93</span>    <span style="color:#999;font-style:italic">// Token: 0x04000007 RID: 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">94</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">const</span> <span style="color:#6ab825;font-weight:bold">string</span> I = <span style="color:#ed9d13">&#34;1L1SA61493DRV53Z&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">95</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">96</span>    <span style="color:#999;font-style:italic">// Token: 0x04000008 RID: 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">97</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">const</span> <span style="color:#6ab825;font-weight:bold">string</span> SA = <span style="color:#ed9d13">&#34;1313Rf99&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">98</span>  }
</code></pre></div><p>Running the script, we get our decrypted password for administrator.</p>
<p><img src="/img/htb_nest/3.png" alt=""></p>
<p>Creds found:</p>
<blockquote>
<p>User: Administrator<br>
Password: XtH4nkS4Pl4y1nGX</p>
</blockquote>
<p>Now we use the creds to get into the C$ share on smb</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>smbclient <span style="color:#ed9d13">\\\\</span>10.10.10.178<span style="color:#ed9d13">\\</span>Users -U Administrator%XtH4nkS4Pl4y1nGX
</code></pre></div><p>We successfully got in. Now we can read our root.txt file from
<code>C:\Users\Administrator\Desktop\root.txt</code></p>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-nest-writeup/" title="Hackthebox - Nest Writeup" target="_blank" rel="external">https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-nest-writeup/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Licenseï¼š</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/fmash16" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://fmash16.github.io/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/fmash16" target="_blank"><span class="text-dark">fmash16</span></a></h3>
        <div>Hack the Planet</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" title="Hackthebox - Resolute Writeup"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Index</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="facebook,twitter"
                data-mobile-sites="">Share on:</div>
        </div>
    </div>
</nav>



</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/fmash16" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://fmash16.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="https://twitter.com/fmash16" target="_blank" title="twitter" data-toggle=tooltip data-placement=top >
            <i class="icon icon-twitter"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2020  -
    2020
    
    
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"></script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://fmash16.github.io/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="https://fmash16.github.io/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
            },
            ROOT_URL: 'https:\/\/fmash16.github.io\/',
            CONTENT_URL: 'https:\/\/fmash16.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://fmash16.github.io/js/insight.min.7f3407251ef14950645ac695d0cf7cd29c5cabfb6916e63dcb54b83d8f1fc2126d10bd5446875e78d27a76ecd651a3532b49a7e4da02ee4de51660edba2d23f1.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


/* copy code button */
<script>
function addCopyButtons(clipboard) {
    document.querySelectorAll('pre > code').forEach(function (codeBlock) {
        var button = document.createElement('button');
        button.className = 'copy-code-button';
        button.type = 'button';
        button.innerText = 'Copy';

        button.addEventListener('click', function () {
              
            tmp = codeBlock.innerText.split("\n");
            cutChar = (tmp.length>8) ? 2 : 1;
            for(i=0; i<tmp.length; i++){
              tmp[i] = tmp[i].substring(cutChar);
            }
            block = tmp.join("\n");
            clipboard.writeText(block).then(function () {
                

                button.blur();

                button.innerText = 'Copied!';

                setTimeout(function () {
                    button.innerText = 'Copy';
                }, 2000);
            }, function (error) {
                button.innerText = 'Error';
            });
        });

        var pre = codeBlock.parentNode;
        if (pre.parentNode.classList.contains('highlight')) {
            var highlight = pre.parentNode;
            highlight.parentNode.insertBefore(button, highlight);
        } else {
            pre.parentNode.insertBefore(button, pre);
        }
    });
}
if (navigator && navigator.clipboard) {
    addCopyButtons(navigator.clipboard);
} else {
    var script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js';
    script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=';
    script.crossOrigin = 'anonymous';
    script.onload = function() {
        addCopyButtons(clipboard);
    };

    document.body.appendChild(script);
}

</script>



  </body>
</html>
