<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        Ryzen Gpu passthrough guide on debian - fmash16&#39;s blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="A guide to passthrough your gpu to a QEMU/KVM virtual machine running Windows 10" />
    <meta name="generator" content="Hugo 0.71.0 with theme pure" />
    <title>Ryzen Gpu passthrough guide on debian - fmash16&#39;s blog</title>
    
    
    <link rel="stylesheet" href="https://fmash16.github.io/css/style.min.745bc926246c6b0a7b61fa3e356d777af8cf8cb72e19d3d4be47ef7e62010f05.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="Ryzen Gpu passthrough guide on debian" />
<meta property="og:description" content="A guide to passthrough your gpu to a QEMU/KVM virtual machine running Windows 10" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fmash16.github.io/2020/03/gpu_passthrough/" />
<meta property="article:published_time" content="2020-03-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-02T00:00:00+00:00" />
<meta itemprop="name" content="Ryzen Gpu passthrough guide on debian">
<meta itemprop="description" content="A guide to passthrough your gpu to a QEMU/KVM virtual machine running Windows 10">
<meta itemprop="datePublished" content="2020-03-02T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-03-02T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3067">



<meta itemprop="keywords" content="qemu,kvm,virtualization,passthrough," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ryzen Gpu passthrough guide on debian"/>
<meta name="twitter:description" content="A guide to passthrough your gpu to a QEMU/KVM virtual machine running Windows 10"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->

   
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto&#43;Sans&#43;JP&amp;display=swap" type="text/css" media="all" /> 
   

  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle img-rotate" src="https://fmash16.github.io/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">fmash16</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Student</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dhaka, Bangladesh</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>

        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Posts</span>
                </a>
            </li>
            <li class="menu-item menu-item-books">
                <a href="/categories/">
                    <i class="icon icon-book-fill"></i>
                  <span class="menu-title">Writeups</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
  <h3 class="widget-title"><u> Categories</u></h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://fmash16.github.io/categories/hackthebox-writeups/" class="category-list-link">hackthebox-writeups</a><span class="category-list-count">7</span></li>
            <li class="category-list-item"><a href="https://fmash16.github.io/categories/tryhackme-writeups/" class="category-list-link">tryhackme-writeups</a><span class="category-list-count">4</span></li>
        </ul>
    </div>
</div>
<div class="widget">
  <h3 class="widget-title"><u> Tags </u></h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <a href="https://fmash16.github.io/tags/ad/" class="tag-list-link">ad</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/adminer/" class="tag-list-link">adminer</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/azure/" class="tag-list-link">azure</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/azure-ad-connect/" class="tag-list-link">azure-ad-connect</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/bludit-cms/" class="tag-list-link">bludit-cms</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/brainfuck/" class="tag-list-link">brainfuck</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cewl/" class="tag-list-link">cewl</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/command-injection/" class="tag-list-link">command-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/crackmapexec/" class="tag-list-link">crackmapexec</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cron/" class="tag-list-link">cron</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/crontab/" class="tag-list-link">crontab</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/cve-2019-14287/" class="tag-list-link">cve-2019-14287</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dll/" class="tag-list-link">dll</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dns/" class="tag-list-link">dns</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dnsadmins/" class="tag-list-link">dnsadmins</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/docker/" class="tag-list-link">docker</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/dynamic-js/" class="tag-list-link">dynamic-js</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/dynamic-xss/" class="tag-list-link">dynamic-xss</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/easy/" class="tag-list-link">easy</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/evil-winrm/" class="tag-list-link">evil-winrm</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/file-descriptor/" class="tag-list-link">file-descriptor</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/ftp/" class="tag-list-link">ftp</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/fuzzing/" class="tag-list-link">fuzzing</a><span class="tag-list-count">4</span>
            
            
            <a href="https://fmash16.github.io/tags/gila-cms/" class="tag-list-link">gila-cms</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/gtfobins/" class="tag-list-link">gtfobins</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/hacking/" class="tag-list-link">hacking</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/hydra/" class="tag-list-link">hydra</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/injection/" class="tag-list-link">injection</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/john/" class="tag-list-link">john</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/kvm/" class="tag-list-link">kvm</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/ldap/" class="tag-list-link">ldap</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/ldapsearch/" class="tag-list-link">ldapsearch</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/lfi/" class="tag-list-link">lfi</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/linux/" class="tag-list-link">linux</a><span class="tag-list-count">3</span>
            
            
            <a href="https://fmash16.github.io/tags/logrotate-race-condition/" class="tag-list-link">logrotate-race-condition</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/mysql/" class="tag-list-link">mysql</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/mysqldump/" class="tag-list-link">mysqldump</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/passthrough/" class="tag-list-link">passthrough</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/php/" class="tag-list-link">php</a><span class="tag-list-count">4</span>
            
            
            <a href="https://fmash16.github.io/tags/powershell/" class="tag-list-link">powershell</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/practice/" class="tag-list-link">practice</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/privesc/" class="tag-list-link">privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/pt_chown/" class="tag-list-link">pt_chown</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/pwn/" class="tag-list-link">pwn</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/python/" class="tag-list-link">python</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/python-path-hijack/" class="tag-list-link">python-path-hijack</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/qemu/" class="tag-list-link">qemu</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/rce/" class="tag-list-link">rce</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/real-world/" class="tag-list-link">real-world</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/rpcclient/" class="tag-list-link">rpcclient</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sql/" class="tag-list-link">sql</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sql-truncation-attack/" class="tag-list-link">sql-truncation-attack</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/stego/" class="tag-list-link">stego</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/subdomain/" class="tag-list-link">subdomain</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/sudo/" class="tag-list-link">sudo</a><span class="tag-list-count">2</span>
            
            
            <a href="https://fmash16.github.io/tags/sudo-privesc/" class="tag-list-link">sudo-privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/tar/" class="tag-list-link">tar</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/virtualization/" class="tag-list-link">virtualization</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/web/" class="tag-list-link">web</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/wfuzz/" class="tag-list-link">wfuzz</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/wildcard/" class="tag-list-link">wildcard</a><span class="tag-list-count">1</span>
            
            
            <a href="https://fmash16.github.io/tags/xss/" class="tag-list-link">xss</a><span class="tag-list-count">1</span>
            
        </ul>

    </div>
</div>

<div class="widget">
  <h3 class="widget-title"><u> Recent Posts </u></h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" class="title">Hackthebox - Resolute Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-28 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-28</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-book-writeup/" class="title">Hackthebox - Book Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-04</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/tryhackme-writeups/tryhackme-cmess-writeup/" class="title">TryHackMe - CMesS Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-03 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-03</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-blunder-writeup/" class="title">Hackthebox - Blunder Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-31 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-31</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://fmash16.github.io/writeups/hackthebox-writeups/hackthebox-montevarde-writeup/" class="title">Hackthebox - Montevarde Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-30 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-30</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>

  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Table of Contents</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>

<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h3 itemprop="name">
  <a
    class="article-title"
    href="/2020/03/gpu_passthrough/"
    >Ryzen Gpu passthrough guide on debian</a
  >
</h3>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://fmash16.github.io/2020/03/gpu_passthrough/" class="article-date">
  <time datetime="2020-03-02 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-03-02</time>
</a>
</span>
  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/qemu/"> qemu </a>
    <a class="article-tag-link" href="/tags/kvm/"> kvm </a>
    <a class="article-tag-link" href="/tags/virtualization/"> virtualization </a>
    <a class="article-tag-link" href="/tags/passthrough/"> passthrough </a>
  </span>
<br>
        
        
        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h2 id="preamble">Preamble</h2>
<p>This guide shows how to passthrough a gpu to a vm running on QEMU/KVM on linux
for improved graphical performance. In my case, I did it to run windows and
play games while I can still work on my linux machine. Dual booting is not
a good solution in this case as rebooting into windows just for the purpose of
gaming is a pain. Passing through my gpu, I can switch between games and work
with muxh ease. This is a guide of how I set it up on my machine running Debian
10.</p>
<h2 id="introduction-to-vfio-and-pci-passthrough">Introduction to VFIO and PCI passthrough:</h2>
<p><a href="https://www.kernel.org/doc/Documentation/vfio.txt">Virtual Function IO</a> (or
VFIO) allows a virtual machine (VM) direct access to a pci hardware resource,
such as a graphics processing unit (GPU). Virtual machines with set up GPU
passthrough can gain close to bare metal performance, which makes running games
in a Windows virtual machine possible.</p>
<p>Unfortunately, the setup process can be pretty complex. It consists of fixed
base settings, some variable settings and several optional (mostly performance)
settings. In order to sustain readability of this post, and because I aim to
use the virtual machine for gaming only, I minimized the variable parts for
latency optimization. The variable topics itself are linked in articles
â€“ I hope this makes sense. ðŸ™‚</p>
<h2 id="requirements">Requirements:</h2>
<h2 id="hardware">Hardware:</h2>
<p>In order to successfully follow this guide, it is mandatory that the used
hardware supports virtualization and IOMMU groups.</p>
<p>The hardware I use is as follows:</p>
<ul>
<li>Ryzen 6 2600 @ 4.00Ghz</li>
<li>MSI X470 Gaming Plus</li>
<li>24gb corsair vengeance 3200Mhz cl16 RAM</li>
<li>240GB WD Green SSD for vm</li>
<li>NVIDIA GT710 (host gpu)</li>
<li>AMD Radeon RX580 (passthrough gpu)</li>
</ul>
<h2 id="software">Software:</h2>
<p>Before we start, install the virtualization manager and related software via:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>sudo apt-get install libvirt-bin bridge-utils virt-manager qemu-kvm ovmf
</code></pre></div><h2 id="setting-up-the-vfio-ryzen-passthrough">Setting up the vfio ryzen passthrough:</h2>
<p>Devices connected to the mainboard, are members of (IOMMU) groups â€“ depending
on where and how they are connected. It is possible to pass devices into
a virtual machine. Passed through devices have nearly bare metal performance
when used inside the VM.</p>
<p>On the downside, passed through devices are isolated and thus no longer
available to the host system. Furthermore it is only possible to isolate all
devices of one IOMMU group at the same time. This means, even when not used in
the VM if a devices is IOMMU-group sibling of a passed through device, it can
not be used on the host system.</p>
<h2 id="enabling-the-iommu-feature">Enabling the IOMMU feature:</h2>
<p>To enable the IOMMU feature on an AMD Ryzen system, modify your grub config.
Run <code>sudo nano /etc/default/grub</code> and edit the line which starts with
<code>GRUB_CMDLINE_LINUX_DEFAULT</code>, to match:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span><span style="color:#40ffff">GRUB_CMDLINE_LINUX_DEFAULT</span>=<span style="color:#ed9d13">&#34;amd_iommu=on iommu=pt kvm_amd.npt=1 kvm_amd.avic=1&#34;</span>
</code></pre></div><p>in case you are using an Intel CPU the line should read:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span><span style="color:#40ffff">GRUB_CMDLINE_LINUX_DEFAULT</span>=<span style="color:#ed9d13">&#34;intel_iommu=on&#34;</span>
</code></pre></div><p>Save the changes and update grub.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>sudo update-grub
</code></pre></div><p>Reboot your system when the command has finished.</p>
<p>One can verify after a system start if IOMMU is enabled by running:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>dmesg |grep AMD-Vi
</code></pre></div><p>My output:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>[    0.758804] AMD-Vi: IOMMU performance counters supported                             
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>[    0.760735] AMD-Vi: Found IOMMU at 0000:00:00.2 cap 0x40                             
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span>[    0.760737] AMD-Vi: Extended features (0xf77ef22294ada):                             
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4</span>[    0.760741] AMD-Vi: Interrupt remapping enabled  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5</span>[    0.760742] AMD-Vi: virtual APIC enabled         
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">6</span>[    0.760832] AMD-Vi: Lazy IO/TLB flushing enabled 
</code></pre></div><h2 id="finding-the-iommu-group-of-the-guest-gpu-to-isolate">Finding the iommu group of the guest gpu to isolate:</h2>
<p>In order to activate the hardware passthrough for virtual machines, we have to
make sure the nvidia/amd driver is not taking ownership of the PCIe devices;
isolate it before we can hand it over.</p>
<p>This is done by applying the vfio-pci to the guest GPU, during the system
startup.</p>
<p>Depending on the PCIe slot installed, the hardware has different IOMMU group
affilation. One can use a bash script like this in order to determine devices
and their grouping:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span><span style="color:#cd2828;font-weight:bold">#!/bin/bash
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span><span style="color:#cd2828;font-weight:bold"></span><span style="color:#24909d">shopt</span> -s nullglob
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span><span style="color:#6ab825;font-weight:bold">for</span> d in /sys/kernel/iommu_groups/*/devices/*; <span style="color:#6ab825;font-weight:bold">do</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4</span>    <span style="color:#40ffff">n</span>=<span style="color:#ed9d13">${</span><span style="color:#40ffff">d</span>#*/iommu_groups/*<span style="color:#ed9d13">}</span>; <span style="color:#40ffff">n</span>=<span style="color:#ed9d13">${</span><span style="color:#40ffff">n</span>%%/*<span style="color:#ed9d13">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5</span>    <span style="color:#24909d">printf</span> <span style="color:#ed9d13">&#39;IOMMU Group %s &#39;</span> <span style="color:#ed9d13">&#34;</span><span style="color:#40ffff">$n</span><span style="color:#ed9d13">&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">6</span>    lspci -nns <span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">${</span><span style="color:#40ffff">d</span>##*/<span style="color:#ed9d13">}</span><span style="color:#ed9d13">&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">7</span><span style="color:#6ab825;font-weight:bold">done</span>;
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1</span>IOMMU Group <span style="color:#3677a9">0</span> 00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2</span>Family 17h PCIe Dummy Host Bridge [1022:1452]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3</span>IOMMU Group <span style="color:#3677a9">10</span> 00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4</span>Family 17h Internal PCIe GPP Bridge <span style="color:#3677a9">0</span> to Bus B [1022:1454]     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5</span>IOMMU Group <span style="color:#3677a9">11</span> 00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6</span>SMBus Contro(rev 59)                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7</span>IOMMU Group <span style="color:#3677a9">11</span> 00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8</span>FCH LPC Brirev 51)                   
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">0</span> [1022:1460]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">11</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">12</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">1</span> [1022:1461]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">13</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">14</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">2</span> [1022:1462]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">15</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">16</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">3</span> [1022:1463]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">17</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">18</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">4</span> [1022:1464]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">19</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">20</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">5</span> [1022:1465]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">21</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">22</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">6</span> [1022:1466]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">23</span>IOMMU Group <span style="color:#3677a9">12</span> 00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">24</span>Family 17h Data Fabric: Device 18h; Function <span style="color:#3677a9">7</span> [1022:1467]    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">25</span>IOMMU Group <span style="color:#3677a9">13</span> 03:00.0 USB controller [0c03]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">26</span>[AMD] Device 01)                       
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">27</span>IOMMU Group <span style="color:#3677a9">13</span> 03:00.1 SATA controller [0106]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">28</span>[AMD] <span style="color:#3677a9">400</span> Se Controller [1022:43c8] (rev 01)                    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">29</span>IOMMU Group <span style="color:#3677a9">13</span> 03:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">30</span><span style="color:#3677a9">400</span> Series ge [1022:43c6] (rev 01)   
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">31</span>IOMMU Group <span style="color:#3677a9">13</span> 16:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">32</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">33</span>IOMMU Group <span style="color:#3677a9">13</span> 16:01.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">34</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">35</span>IOMMU Group <span style="color:#3677a9">13</span> 16:02.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">36</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">37</span>IOMMU Group <span style="color:#3677a9">13</span> 16:03.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">38</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">39</span>IOMMU Group <span style="color:#3677a9">13</span> 16:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">40</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">41</span>IOMMU Group <span style="color:#3677a9">13</span> 16:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">42</span><span style="color:#3677a9">400</span> Series  [1022:43c7] (rev 01)     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">43</span>IOMMU Group <span style="color:#3677a9">13</span> 18:00.0 Ethernet controller [0200]: Realtek Semiconductor Co.,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">44</span>Ltd. RTL81Express Gigabit Ethernet Controller [10ec:8168] (rev 15)                                
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">45</span>IOMMU Group <span style="color:#3677a9">13</span> 1c:00.0 USB controller [0c03]: ASMedia Technology Inc. ASM1143
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">46</span>USB 3.1 Ho21:1343]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">47</span>IOMMU Group <span style="color:#3677a9">14</span> 1d:00.0 VGA compatible controller [0300]: NVIDIA Corporation
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">48</span>GK208 [GeFor:128b] (rev a1)           
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">49</span>IOMMU Group <span style="color:#3677a9">14</span> 1d:00.1 Audio device [0403]: NVIDIA Corporation GK208 HDMI/DP
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">50</span>Audio Contr (rev a1)                 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">51</span>IOMMU Group <span style="color:#3677a9">15</span> 1e:00.0 VGA compatible controller [0300]: Advanced Micro
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">52</span>Devices, Inc. [A [Radeon RX 470/480] [1002:67df] (rev e7)           
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">53</span>IOMMU Group <span style="color:#3677a9">15</span> 1e:00.1 Audio device [0403]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">54</span>[AMD/ATI] EllesRadeon RX 470/480 / 570/580/590] [1002:aaf0]        
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">55</span>IOMMU Group <span style="color:#3677a9">16</span> 1f:00.0 Non-Essential Instrumentation [1300]: Advanced Micro
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">56</span>Devices, IncRaven/Raven2 PCIe Dummy Function [1022:145a]        
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">57</span>IOMMU Group <span style="color:#3677a9">17</span> 1f:00.2 Encryption controller [1080]: Advanced Micro Devices,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">58</span>Inc. [AMD] s 00h-0fh) Platform Security Processor [1022:1456]  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">59</span>IOMMU Group <span style="color:#3677a9">18</span> 1f:00.3 USB controller [0c03]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">60</span>[AMD] USB 3.0[1022:145f]               
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">61</span>IOMMU Group <span style="color:#3677a9">19</span> 20:00.0 Non-Essential Instrumentation [1300]: Advanced Micro
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">62</span>Devices, IncRenoir PCIe Dummy Function [1022:1455]              
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">63</span>IOMMU Group <span style="color:#3677a9">1</span> 00:01.3 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">64</span>Family 17h (CIe GPP Bridge [1022:1453]                          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">65</span>IOMMU Group <span style="color:#3677a9">20</span> 20:00.2 SATA controller [0106]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">66</span>[AMD] FCH SACI mode] [1022:7901] (rev 51)                       
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">67</span>IOMMU Group <span style="color:#3677a9">21</span> 20:00.3 Audio device [0403]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">68</span>Family 17) HD Audio Controller [1022:1457]                   
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">69</span>IOMMU Group <span style="color:#3677a9">2</span> 00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">70</span>Family 17h PCIe Dummy Host Bridge [1022:1452]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">71</span>IOMMU Group <span style="color:#3677a9">3</span> 00:03.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">72</span>Family 17h PCIe Dummy Host Bridge [1022:1452]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">73</span>IOMMU Group <span style="color:#3677a9">4</span> 00:03.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">74</span>Family 17h (CIe GPP Bridge [1022:1453]                          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">75</span>IOMMU Group <span style="color:#3677a9">5</span> 00:03.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">76</span>Family 17h (CIe GPP Bridge [1022:1453]                          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">77</span>IOMMU Group <span style="color:#3677a9">6</span> 00:04.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">78</span>Family 17h PCIe Dummy Host Bridge [1022:1452]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">79</span>IOMMU Group <span style="color:#3677a9">7</span> 00:07.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">80</span>Family 17h PCIe Dummy Host Bridge [1022:1452]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">81</span>IOMMU Group <span style="color:#3677a9">8</span> 00:07.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">82</span>Family 17h (nternal PCIe GPP Bridge <span style="color:#3677a9">0</span> to Bus B [1022:1454]      
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">83</span>IOMMU Group <span style="color:#3677a9">9</span> 00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">84</span>Family 17h PCIe Dummy Host Bridge [1022:1452]
</code></pre></div><p>We are looking for the device id of the guest GPU (in my case, Radeon RX
470/480)
for isolation. Keep in mind that the GPU usually comes combined with an audio
device.</p>
<p>We will isolate the GPU in PCIe slot 2, with host gpu in PCIe slot 1.</p>
<p>For the next step only the GPU-Id is needed.
We have to isolate <code>1002:67df</code> and <code>1002:aaf0</code></p>
<h2 id="isolation-of-guest-gpu">Isolation of guest gpu</h2>
<p>In order to isolate the gfx card modify <code>/etc/initramfs-tools/modules</code> via:
<code>sudo nano /etc/initramfs-tools/modules</code> and add:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>softdep amdgpu pre: vfio vfio_pci
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>vfio vfio_iommu_type1 vfio_virqfd vfio_pci <span style="color:#40ffff">ids</span>=1002:67df,1002:aaf0
</code></pre></div><p>modify <code>/etc/modules</code> aswell via: <code>sudo nano /etc/modules</code> and add:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>vfio
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>vfio_iommu_type1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span>vfio_pci <span style="color:#40ffff">ids</span>=1002:67df,1002:aaf0
</code></pre></div><p>These changes will pass device-ids to the vfio_pci module, in order to reserve
these devices for the passthrough. It is crucial that the vfio_pci module
claims the GPU before the actual driver (in this case the nvidia graphic-cards
driver) loads, otherwise it is not possible to isolate the GPU. Make sure your
cards are using the Nvidia driver (not nouvea one).</p>
<p>In order to alter the load sequence in favour to vfio_pci before the nvidia
driver, create a file in the <code>modprobe.d</code> folder via <code>sudo nano /etc/modprobe.d/nvidia.conf</code> and add the the following line:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>softdep nouveau pre: vfio-pci 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2</span>softdep nvidia pre: vfio-pci 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3</span>softdep nvidia* pre: vfio-pci
</code></pre></div><p>Create another file via <code>sudo nano /etc/modprobe.d/vfio.conf</code> to add the the
following line:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>options vfio-pci <span style="color:#40ffff">ids</span>=1002:67df,1002:aaf0
</code></pre></div><p>Obviously, the ids have to be the same we have added before to the modules
file. Now save and close the file.</p>
<p>Since the Windows 10 update 1803 the following additional entry needs to be set
(otherwise BSOD) create the kvm.conf file via<code> sudo nano /etc/modprobe.d/kvm.conf</code> to add the the following line:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>options kvm <span style="color:#40ffff">ignore_msrs</span>=<span style="color:#3677a9">1</span>
</code></pre></div><p>Save and close the file.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>when all is <span style="color:#6ab825;font-weight:bold">done</span> run: sudo update-initramfs -u -k all
</code></pre></div><h2 id="verify-the-isolation">Verify the isolation</h2>
<p>In order to verify a proper isolation of the device, run:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1</span>lspci -nnv
</code></pre></div><p>find the line <code>&quot;Kernel driver in use&quot;</code> for the GPU and its audio part. It should
state <code>vfio-pci</code>.</p>
<p>My output:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1</span>1e:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2</span>[AMD/ATI] Ellesmere [Radeon RX 470/480] [1002:67df] (rev e7) (prog-if <span style="color:#3677a9">00</span> [VGA
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3</span>controller])               
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4</span>        Subsystem: Sapphire Technology Limited Ellesmere [Radeon RX
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5</span>470/480/570/570X/580/580X/590] (Nitro+ Radeon RX 570/580) [1da2:e366]                                       
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6</span>        Flags: fast devsel, IRQ <span style="color:#3677a9">11</span>          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7</span>        Memory at d0000000 (64-bit, prefetchable) [disabled] [<span style="color:#40ffff">size</span>=256M]                
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8</span>        Memory at e0000000 (64-bit, prefetchable) [disabled] [<span style="color:#40ffff">size</span>=2M]                  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9</span>        I/O ports at d000 [disabled] [<span style="color:#40ffff">size</span>=256]                                         
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10</span>        Memory at f7900000 (32-bit, non-prefetchable) [disabled] [<span style="color:#40ffff">size</span>=256K]            
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">11</span>        Expansion ROM at f7940000 [disabled] [<span style="color:#40ffff">size</span>=128K]                                
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">12</span>        Capabilities: &lt;access denied&gt;       
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">13</span>        Kernel driver in use: vfio-pci      
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">14</span>        Kernel modules: amdgpu              
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">16</span>1e:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Ellesmere
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">17</span>HDMI Audio [Radeon RX 470/480 / 570/580/590] [1002:aaf0]                                          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">18</span>        Subsystem: Sapphire Technology Limited Ellesmere HDMI Audio [Radeon RX
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">19</span>470/480 / 570/580/590] [1da2:aaf0]                   
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">20</span>        Flags: fast devsel, IRQ <span style="color:#3677a9">10</span>          
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">21</span>        Memory at f7960000 (64-bit, non-prefetchable) [disabled] [<span style="color:#40ffff">size</span>=16K]             
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">22</span>        Capabilities: &lt;access denied&gt;       
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">23</span>        Kernel driver in use: vfio-pci      
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">24</span>        Kernel modules: snd_hda_intel       
</code></pre></div><h2 id="creating-the-windows-virtual-machine">Creating the windows virtual machine</h2>
<p>The virtualization is done via an open source machine emulator and virtualizer
called QEMU. One can either run qemu directly, or use a GUI called virt-manager
in order setup, and run a virtual machine. I prefer using the GUI.
Unfortunately not every settings is supported in the Virtual Manager. Thus,
I define the basic settings in the UI do a quick VM start and force stop it
right after I see the GPU is passed-over correctly. Afterwards one can edit the
missing bits into the VM config via virsh.</p>
<ol>
<li>
<p>Open <code>virt-manager</code></p>
<p><img src="/img/virt-manager.png" alt="image"></p>
</li>
<li>
<p>Create a new windows virtual machine</p>
<p><img src="/img/virt1.png" alt="image"></p>
</li>
<li>
<p>Select the iso file of windows10</p>
<p><img src="/img/virt2.png" alt="image"></p>
</li>
<li>
<p>Choose the desired amount of RAM and CPU cores</p>
<p><img src="/img/virt3.png" alt="image"></p>
</li>
<li>
<p>Create a custom storage(since we are using a wholess SSD for this vm)</p>
<p><img src="/img/virt4.png" alt="image"></p>
</li>
<li>
<p>Add a new pool</p>
<p><img src="/img/virt5.png" alt="image"></p>
</li>
<li>
<p>First, find the dev name of your ssd for vm using the command <code>lsblk</code> in
terminal. In my case, it was /dev/sdc. You must select physical disk drive
as we are using a seperate disk.</p>
<p><img src="/img/virt6.png" alt="image"></p>
</li>
<li>
<p>Build the pool</p>
<p><img src="/img/virt7.png" alt="image"></p>
</li>
<li>
<p>Next create a new volume in the pool by the name <code>win10</code>(or whatever you
like). and select this voilume as the storage.</p>
</li>
<li>
<p>You must check the box</p>
<p><img src="/img/virt8.png" alt="image"></p>
</li>
<li>
<p>After finishing, the following box will appear. Select chipset <code>Q35</code>
and firmware <code>uefi</code> and apply.</p>
<p><img src="/img/virt9.png" alt="image"></p>
</li>
<li>
<p>In the CPUs, manually set the cpu topology with 1 socket and cores and
threads as your choice, better follow usual configurations of cores/threads</p>
<p><img src="/img/virt10.png" alt="image"></p>
</li>
<li>
<p>Remove the <code>Display spice</code> and <code>Video QXL</code> from the hardwares.</p>
</li>
<li>
<p>Go to <code>Add hardware</code>, there yoiu will find your passthrough gpu and
sound in the <code>pci host device</code> section. Add those.</p>
<p><img src="/img/virt11.png" alt="image"></p>
</li>
<li>
<blockquote>
<p>A problem that I faced during installing windows is that I couldn&rsquo;t boot
into the iso file inserted as cd rom and got stuck on the UEFI shell. Going
into the bios, I still couldn&rsquo;t boot from the iso. But when I used BIOS instead
of UEFI, it booted into windows installation alright, but going to install
windows, it shows that my disk is GPT instead of MBR required for BIOS, and so
cannot install windows to that disk.</p>
</blockquote>
<p>So, what you have to do is create a windows bootable drive with GPT. You can do
this in many ways, either in linux or using a sofware like rufus on windows.
Create a bootable pendrive and attach it. Now in the <code>add hardware</code>
section, under the <code>USB Host Device</code>, you will find your pendrive. Add it.</p>
<p><img src="/img/virt12.png" alt="image"></p>
</li>
<li>
<p>Go to boot options, check <code>Enable boot menu</code> and in the serial, check
and move
the USB device(your bootable drive), to the top.</p>
<p><img src="/img/virt13.png" alt="image"></p>
</li>
<li>
<p>Next, start installation.</p>
</li>
</ol>
<h2 id="install-windows">Install windows:</h2>
<p>Connect a second monitor to you host gpu, or you can connect to the monnitor
you already have and can switch the inputs between your host and guest gpu.</p>
<p>The windows installation should come up, install windows and voila! you are
done, almost</p>
<h2 id="install-necessary-drivers">Install necessary drivers</h2>
<p>Performance is supposed to get better if you use virtio drivers on windows,
Download the virtio drivers and attack them to the vm as a cdrom device and
install the drivers from there.</p>
<p>You must also install the required graphics drivers(Radeon/NVIDIA) to eliminate
display issues (in my case , I was not gettint the 1080p resolution).</p>
<h2 id="editing-configurations-using-virsh">Editing configurations using virsh</h2>
<p>You can edit the config of your vm from terminal by editing the xml file
generate, To edit the xml file, in the termial, type
<code>virsh edit win10</code>
In place if win10, place the name of your windows vm.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  1</span><span style="color:#6ab825;font-weight:bold">&lt;domain</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;kvm&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  2</span>  <span style="color:#6ab825;font-weight:bold">&lt;name&gt;</span>win10<span style="color:#6ab825;font-weight:bold">&lt;/name&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  3</span>  <span style="color:#6ab825;font-weight:bold">&lt;uuid&gt;</span>ba67aec1-75a4-4639-b905-2e9c444aef85<span style="color:#6ab825;font-weight:bold">&lt;/uuid&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  4</span>  <span style="color:#6ab825;font-weight:bold">&lt;metadata&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  5</span>    <span style="color:#6ab825;font-weight:bold">&lt;libosinfo:libosinfo</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  6</span><span style="color:#bbb">xmlns:libosinfo=</span><span style="color:#ed9d13">&#34;http://libosinfo.org/xmlns/libvirt/domain/1.0&#34;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  7</span>      <span style="color:#6ab825;font-weight:bold">&lt;libosinfo:os</span> <span style="color:#bbb">id=</span><span style="color:#ed9d13">&#34;http://microsoft.com/win/10&#34;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  8</span>    <span style="color:#6ab825;font-weight:bold">&lt;/libosinfo:libosinfo&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">  9</span>  <span style="color:#6ab825;font-weight:bold">&lt;/metadata&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 10</span>  <span style="color:#6ab825;font-weight:bold">&lt;memory</span> <span style="color:#bbb">unit=</span><span style="color:#ed9d13">&#39;KiB&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>8388608<span style="color:#6ab825;font-weight:bold">&lt;/memory&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 11</span>  <span style="color:#6ab825;font-weight:bold">&lt;currentMemory</span> <span style="color:#bbb">unit=</span><span style="color:#ed9d13">&#39;KiB&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>8388608<span style="color:#6ab825;font-weight:bold">&lt;/currentMemory&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 12</span>  <span style="color:#6ab825;font-weight:bold">&lt;vcpu</span> <span style="color:#bbb">placement=</span><span style="color:#ed9d13">&#39;static&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>6<span style="color:#6ab825;font-weight:bold">&lt;/vcpu&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 13</span>  <span style="color:#6ab825;font-weight:bold">&lt;os&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 14</span>    <span style="color:#6ab825;font-weight:bold">&lt;type</span> <span style="color:#bbb">arch=</span><span style="color:#ed9d13">&#39;x86_64&#39;</span> <span style="color:#bbb">machine=</span><span style="color:#ed9d13">&#39;pc-q35-3.1&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>hvm<span style="color:#6ab825;font-weight:bold">&lt;/type&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 15</span>    <span style="color:#6ab825;font-weight:bold">&lt;loader</span> <span style="color:#bbb">readonly=</span><span style="color:#ed9d13">&#39;yes&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pflash&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>/usr/share/OVMF/OVMF_CODE.fd<span style="color:#6ab825;font-weight:bold">&lt;/loader&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 16</span>    <span style="color:#6ab825;font-weight:bold">&lt;nvram&gt;</span>/var/lib/libvirt/qemu/nvram/win10_VARS.fd<span style="color:#6ab825;font-weight:bold">&lt;/nvram&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 17</span>    <span style="color:#6ab825;font-weight:bold">&lt;bootmenu</span> <span style="color:#bbb">enable=</span><span style="color:#ed9d13">&#39;yes&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 18</span>  <span style="color:#6ab825;font-weight:bold">&lt;/os&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 19</span>  <span style="color:#6ab825;font-weight:bold">&lt;features&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 20</span>    <span style="color:#6ab825;font-weight:bold">&lt;acpi/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 21</span>    <span style="color:#6ab825;font-weight:bold">&lt;apic/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 22</span>    <span style="color:#6ab825;font-weight:bold">&lt;hyperv&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 23</span>      <span style="color:#6ab825;font-weight:bold">&lt;relaxed</span> <span style="color:#bbb">state=</span><span style="color:#ed9d13">&#39;on&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 24</span>      <span style="color:#6ab825;font-weight:bold">&lt;vapic</span> <span style="color:#bbb">state=</span><span style="color:#ed9d13">&#39;on&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 25</span>      <span style="color:#6ab825;font-weight:bold">&lt;spinlocks</span> <span style="color:#bbb">state=</span><span style="color:#ed9d13">&#39;on&#39;</span> <span style="color:#bbb">retries=</span><span style="color:#ed9d13">&#39;8191&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 26</span>    <span style="color:#6ab825;font-weight:bold">&lt;/hyperv&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 27</span>    <span style="color:#6ab825;font-weight:bold">&lt;vmport</span> <span style="color:#bbb">state=</span><span style="color:#ed9d13">&#39;off&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 28</span>  <span style="color:#6ab825;font-weight:bold">&lt;/features&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 29</span>  <span style="color:#6ab825;font-weight:bold">&lt;cpu</span> <span style="color:#bbb">mode=</span><span style="color:#ed9d13">&#39;host-model&#39;</span> <span style="color:#bbb">check=</span><span style="color:#ed9d13">&#39;partial&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 30</span>    <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">fallback=</span><span style="color:#ed9d13">&#39;allow&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 31</span>    <span style="color:#6ab825;font-weight:bold">&lt;topology</span> <span style="color:#bbb">sockets=</span><span style="color:#ed9d13">&#39;1&#39;</span> <span style="color:#bbb">cores=</span><span style="color:#ed9d13">&#39;6&#39;</span> <span style="color:#bbb">threads=</span><span style="color:#ed9d13">&#39;1&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 32</span>  <span style="color:#6ab825;font-weight:bold">&lt;/cpu&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 33</span>  <span style="color:#6ab825;font-weight:bold">&lt;clock</span> <span style="color:#bbb">offset=</span><span style="color:#ed9d13">&#39;localtime&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 34</span>    <span style="color:#6ab825;font-weight:bold">&lt;timer</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;rtc&#39;</span> <span style="color:#bbb">tickpolicy=</span><span style="color:#ed9d13">&#39;catchup&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 35</span>    <span style="color:#6ab825;font-weight:bold">&lt;timer</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pit&#39;</span> <span style="color:#bbb">tickpolicy=</span><span style="color:#ed9d13">&#39;delay&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 36</span><span style="color:#6ab825;font-weight:bold">&lt;timer</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;hpet&#39;</span> <span style="color:#bbb">present=</span><span style="color:#ed9d13">&#39;no&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 37</span>    <span style="color:#6ab825;font-weight:bold">&lt;timer</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;hypervclock&#39;</span> <span style="color:#bbb">present=</span><span style="color:#ed9d13">&#39;yes&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 38</span>  <span style="color:#6ab825;font-weight:bold">&lt;/clock&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 39</span>  <span style="color:#6ab825;font-weight:bold">&lt;on_poweroff&gt;</span>destroy<span style="color:#6ab825;font-weight:bold">&lt;/on_poweroff&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 40</span>  <span style="color:#6ab825;font-weight:bold">&lt;on_reboot&gt;</span>restart<span style="color:#6ab825;font-weight:bold">&lt;/on_reboot&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 41</span>  <span style="color:#6ab825;font-weight:bold">&lt;on_crash&gt;</span>destroy<span style="color:#6ab825;font-weight:bold">&lt;/on_crash&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 42</span>  <span style="color:#6ab825;font-weight:bold">&lt;pm&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 43</span>    <span style="color:#6ab825;font-weight:bold">&lt;suspend-to-mem</span> <span style="color:#bbb">enabled=</span><span style="color:#ed9d13">&#39;no&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 44</span>    <span style="color:#6ab825;font-weight:bold">&lt;suspend-to-disk</span> <span style="color:#bbb">enabled=</span><span style="color:#ed9d13">&#39;no&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 45</span>  <span style="color:#6ab825;font-weight:bold">&lt;/pm&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 46</span>  <span style="color:#6ab825;font-weight:bold">&lt;devices&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 47</span>    <span style="color:#6ab825;font-weight:bold">&lt;emulator&gt;</span>/usr/bin/qemu-system-x86_64<span style="color:#6ab825;font-weight:bold">&lt;/emulator&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 48</span>    <span style="color:#6ab825;font-weight:bold">&lt;disk</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;block&#39;</span> <span style="color:#bbb">device=</span><span style="color:#ed9d13">&#39;disk&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 49</span>      <span style="color:#6ab825;font-weight:bold">&lt;driver</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;qemu&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;raw&#39;</span> <span style="color:#bbb">cache=</span><span style="color:#ed9d13">&#39;none&#39;</span> <span style="color:#bbb">io=</span><span style="color:#ed9d13">&#39;native&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 50</span>      <span style="color:#6ab825;font-weight:bold">&lt;source</span> <span style="color:#bbb">dev=</span><span style="color:#ed9d13">&#39;/dev/sdc1&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 51</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">dev=</span><span style="color:#ed9d13">&#39;sda&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;sata&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 52</span>      <span style="color:#6ab825;font-weight:bold">&lt;boot</span> <span style="color:#bbb">order=</span><span style="color:#ed9d13">&#39;2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 53</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;drive&#39;</span> <span style="color:#bbb">controller=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">target=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">unit=</span><span style="color:#ed9d13">&#39;0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 54</span>    <span style="color:#6ab825;font-weight:bold">&lt;/disk&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 55</span>    <span style="color:#6ab825;font-weight:bold">&lt;disk</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;file&#39;</span> <span style="color:#bbb">device=</span><span style="color:#ed9d13">&#39;cdrom&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 56</span>      <span style="color:#6ab825;font-weight:bold">&lt;driver</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;qemu&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;raw&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 57</span>      <span style="color:#6ab825;font-weight:bold">&lt;source</span> <span style="color:#bbb">file=</span><span style="color:#ed9d13">&#39;/home/fmash/gpu_passthru/virtio-win-0.1.141.iso&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 58</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">dev=</span><span style="color:#ed9d13">&#39;sdb&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;sata&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 59</span>      <span style="color:#6ab825;font-weight:bold">&lt;readonly/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 60</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;drive&#39;</span> <span style="color:#bbb">controller=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">target=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">unit=</span><span style="color:#ed9d13">&#39;1&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 61</span>    <span style="color:#6ab825;font-weight:bold">&lt;/disk&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 62</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;qemu-xhci&#39;</span> <span style="color:#bbb">ports=</span><span style="color:#ed9d13">&#39;15&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 63</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x02&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 64</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 65</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 66</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;sata&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;0&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 67</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x1f&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 68</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 69</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 70</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 71</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;1&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 72</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 73</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;1&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0x8&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 74</span><span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span> <span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 75</span><span style="color:#bbb">multifunction=</span><span style="color:#ed9d13">&#39;on&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 76</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 77</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;2&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 78</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 79</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;2&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0x9&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 80</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 81</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x1&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 82</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 83</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;3&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 84</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 85</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;3&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0xa&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 86</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 87</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 88</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 89</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;4&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 90</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 91</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;4&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0xb&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 92</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 93</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x3&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 94</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 95</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;5&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 96</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 97</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;5&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0xc&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 98</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 99</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x4&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">100</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">101</span>    <span style="color:#6ab825;font-weight:bold">&lt;controller</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">index=</span><span style="color:#ed9d13">&#39;6&#39;</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">102</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;pcie-root-port&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">103</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">chassis=</span><span style="color:#ed9d13">&#39;6&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0xd&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">104</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x01&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">105</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x5&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">106</span>    <span style="color:#6ab825;font-weight:bold">&lt;/controller&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">107</span>    <span style="color:#6ab825;font-weight:bold">&lt;interface</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;network&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">108</span>      <span style="color:#6ab825;font-weight:bold">&lt;mac</span> <span style="color:#bbb">address=</span><span style="color:#ed9d13">&#39;52:54:00:e4:b0:ef&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">109</span>      <span style="color:#6ab825;font-weight:bold">&lt;source</span> <span style="color:#bbb">network=</span><span style="color:#ed9d13">&#39;default&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">110</span>      <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;e1000e&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">111</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x01&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">112</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">113</span>    <span style="color:#6ab825;font-weight:bold">&lt;/interface&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">114</span>    <span style="color:#6ab825;font-weight:bold">&lt;serial</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pty&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">115</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;isa-serial&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">116</span>        <span style="color:#6ab825;font-weight:bold">&lt;model</span> <span style="color:#bbb">name=</span><span style="color:#ed9d13">&#39;isa-serial&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">117</span><span style="color:#6ab825;font-weight:bold">&lt;/target&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">118</span>    <span style="color:#6ab825;font-weight:bold">&lt;/serial&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">119</span>    <span style="color:#6ab825;font-weight:bold">&lt;console</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pty&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">120</span>      <span style="color:#6ab825;font-weight:bold">&lt;target</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;serial&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">121</span>    <span style="color:#6ab825;font-weight:bold">&lt;/console&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">122</span>    <span style="color:#6ab825;font-weight:bold">&lt;input</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;tablet&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;usb&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">123</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">124</span>    <span style="color:#6ab825;font-weight:bold">&lt;/input&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">125</span>    <span style="color:#6ab825;font-weight:bold">&lt;input</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;mouse&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;ps2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">126</span>    <span style="color:#6ab825;font-weight:bold">&lt;input</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;keyboard&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;ps2&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">127</span>    <span style="color:#6ab825;font-weight:bold">&lt;sound</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;ich9&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">128</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x1b&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">129</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">130</span>    <span style="color:#6ab825;font-weight:bold">&lt;/sound&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">131</span>    <span style="color:#6ab825;font-weight:bold">&lt;hostdev</span> <span style="color:#bbb">mode=</span><span style="color:#ed9d13">&#39;subsystem&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">managed=</span><span style="color:#ed9d13">&#39;yes&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">132</span>      <span style="color:#6ab825;font-weight:bold">&lt;source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">133</span>        <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x1e&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">134</span>      <span style="color:#6ab825;font-weight:bold">&lt;/source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">135</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x03&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">136</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">137</span>    <span style="color:#6ab825;font-weight:bold">&lt;/hostdev&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">138</span>    <span style="color:#6ab825;font-weight:bold">&lt;hostdev</span> <span style="color:#bbb">mode=</span><span style="color:#ed9d13">&#39;subsystem&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">managed=</span><span style="color:#ed9d13">&#39;yes&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">139</span>      <span style="color:#6ab825;font-weight:bold">&lt;source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">140</span>        <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x1e&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span> <span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x1&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">141</span>      <span style="color:#6ab825;font-weight:bold">&lt;/source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">142</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x04&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">143</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">144</span>    <span style="color:#6ab825;font-weight:bold">&lt;/hostdev&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">145</span>    <span style="color:#6ab825;font-weight:bold">&lt;hostdev</span> <span style="color:#bbb">mode=</span><span style="color:#ed9d13">&#39;subsystem&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">managed=</span><span style="color:#ed9d13">&#39;yes&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">146</span>      <span style="color:#6ab825;font-weight:bold">&lt;source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">147</span>        <span style="color:#6ab825;font-weight:bold">&lt;vendor</span> <span style="color:#bbb">id=</span><span style="color:#ed9d13">&#39;0x046d&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">148</span>        <span style="color:#6ab825;font-weight:bold">&lt;product</span> <span style="color:#bbb">id=</span><span style="color:#ed9d13">&#39;0xc07e&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">149</span>      <span style="color:#6ab825;font-weight:bold">&lt;/source&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">150</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;5&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">151</span>    <span style="color:#6ab825;font-weight:bold">&lt;/hostdev&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">152</span>    <span style="color:#6ab825;font-weight:bold">&lt;redirdev</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;spicevmc&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">153</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;3&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">154</span>    <span style="color:#6ab825;font-weight:bold">&lt;/redirdev&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">155</span>    <span style="color:#6ab825;font-weight:bold">&lt;redirdev</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;spicevmc&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">156</span><span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;usb&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0&#39;</span> <span style="color:#bbb">port=</span><span style="color:#ed9d13">&#39;4&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">157</span>    <span style="color:#6ab825;font-weight:bold">&lt;/redirdev&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">158</span>    <span style="color:#6ab825;font-weight:bold">&lt;memballoon</span> <span style="color:#bbb">model=</span><span style="color:#ed9d13">&#39;virtio&#39;</span><span style="color:#6ab825;font-weight:bold">&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">159</span>      <span style="color:#6ab825;font-weight:bold">&lt;address</span> <span style="color:#bbb">type=</span><span style="color:#ed9d13">&#39;pci&#39;</span> <span style="color:#bbb">domain=</span><span style="color:#ed9d13">&#39;0x0000&#39;</span> <span style="color:#bbb">bus=</span><span style="color:#ed9d13">&#39;0x05&#39;</span> <span style="color:#bbb">slot=</span><span style="color:#ed9d13">&#39;0x00&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">160</span><span style="color:#bbb">function=</span><span style="color:#ed9d13">&#39;0x0&#39;</span><span style="color:#6ab825;font-weight:bold">/&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">161</span>    <span style="color:#6ab825;font-weight:bold">&lt;/memballoon&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">162</span>  <span style="color:#6ab825;font-weight:bold">&lt;/devices&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">163</span><span style="color:#6ab825;font-weight:bold">&lt;/domain&gt;</span>
</code></pre></div><p>And thats it! You are done!</p>
<h2 id="sources">Sources</h2>
<p>The guide that I mainly followed is this:</p>
<ul>
<li>(<a href="http://mathiashueber.com/windows-virtual-machine-gpu-passthrough-ubuntu/">http://mathiashueber.com/windows-virtual-machine-gpu-passthrough-ubuntu/</a>)</li>
</ul>
<p>A major part pf my guide has been taken from this guide, but as you know, all
systems are not the same, and so to get my setupo working , I had to follow
somw other resources as well. You must watch the level1tech videos on this
topic. They also got an article on this. The resources I used are:</p>
<ul>
<li>(<a href="https://level1techs.com/article/ryzen-gpu-passthrough-setup-guide-fedora-26-windows-gaming-linux">https://level1techs.com/article/ryzen-gpu-passthrough-setup-guide-fedora-26-windows-gaming-linux</a>)</li>
<li>(<a href="https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough/">https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough/</a>)</li>
<li>(<a href="https://scottlinux.com/2016/08/28/gpu-passthrough-with-kvm-and-debian-linux/">https://scottlinux.com/2016/08/28/gpu-passthrough-with-kvm-and-debian-linux/</a>)</li>
<li>(<a href="https://www.reddit.com/r/VFIO/comments/af71pf/kernel_driver_in_use_amdgpu_instead_of_vfiopci/ee0emkf/">https://www.reddit.com/r/VFIO/comments/af71pf/kernel_driver_in_use_amdgpu_instead_of_vfiopci/ee0emkf/</a>)</li>
</ul>
<p>Videos to watch:
<a href="http://www.youtube.com/watch?v=aLeWg11ZBn0" title="GPU Passthrough for Virtualization with Ryzen: Now Working"><img src="http://img.youtube.com/vi/aLeWg11ZBn0/0.jpg" alt="IMAGE ALTTEXT"></a></p>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="https://fmash16.github.io/2020/03/gpu_passthrough/" title="Ryzen Gpu passthrough guide on debian" target="_blank" rel="external">https://fmash16.github.io/2020/03/gpu_passthrough/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Licenseï¼š</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/fmash16" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://fmash16.github.io/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/fmash16" target="_blank"><span class="text-dark">fmash16</span></a></h3>
        <div>Hack the Planet</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://fmash16.github.io/writeups/ctf_writeups/neverlan_ctf/reverse-engineering/neverlan-ctf-reverse-engineer-writeup/" title="NeverLAN CTF - Reverse Engineer writeup"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://fmash16.github.io/writeups/tryhackme-writeups/tryhackme-basic-pentesting-writeup/"
                    title="TryHackMe - Basic Pentesting Writeup"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Index</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="facebook,twitter"
                data-mobile-sites="">Share on:</div>
        </div>
    </div>
</nav>



</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/fmash16" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://fmash16.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="https://twitter.com/fmash16" target="_blank" title="twitter" data-toggle=tooltip data-placement=top >
            <i class="icon icon-twitter"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2020  -
    2020
    
    
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"></script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://fmash16.github.io/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="https://fmash16.github.io/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
            },
            ROOT_URL: 'https:\/\/fmash16.github.io\/',
            CONTENT_URL: 'https:\/\/fmash16.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://fmash16.github.io/js/insight.min.7f3407251ef14950645ac695d0cf7cd29c5cabfb6916e63dcb54b83d8f1fc2126d10bd5446875e78d27a76ecd651a3532b49a7e4da02ee4de51660edba2d23f1.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


/* copy code button */
<script>
function addCopyButtons(clipboard) {
    document.querySelectorAll('pre > code').forEach(function (codeBlock) {
        var button = document.createElement('button');
        button.className = 'copy-code-button';
        button.type = 'button';
        button.innerText = 'Copy';

        button.addEventListener('click', function () {
              
            tmp = codeBlock.innerText.split("\n");
            cutChar = (tmp.length>8) ? 2 : 1;
            for(i=0; i<tmp.length; i++){
              tmp[i] = tmp[i].substring(cutChar);
            }
            block = tmp.join("\n");
            clipboard.writeText(block).then(function () {
                

                button.blur();

                button.innerText = 'Copied!';

                setTimeout(function () {
                    button.innerText = 'Copy';
                }, 2000);
            }, function (error) {
                button.innerText = 'Error';
            });
        });

        var pre = codeBlock.parentNode;
        if (pre.parentNode.classList.contains('highlight')) {
            var highlight = pre.parentNode;
            highlight.parentNode.insertBefore(button, highlight);
        } else {
            pre.parentNode.insertBefore(button, pre);
        }
    });
}
if (navigator && navigator.clipboard) {
    addCopyButtons(navigator.clipboard);
} else {
    var script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js';
    script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=';
    script.crossOrigin = 'anonymous';
    script.onload = function() {
        addCopyButtons(clipboard);
    };

    document.body.appendChild(script);
}

</script>



  </body>
</html>
